<!DOCTYPE html>
<html dir="ltr" lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="google-signin-client-id" content="157101835696-ooapojlodmuabs2do2vuhhnf90bccmoi.apps.googleusercontent.com">
    <meta name="google-signin-scope" content="profile email https://www.googleapis.com/auth/developerprofiles https://www.googleapis.com/auth/developerprofiles.award">
    <meta property="og:site_name" content="TensorFlow">
    <meta property="og:type" content="website"><meta name="theme-color" content="#ff6f00"><meta charset="utf-8">
    <meta content="IE=Edge" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    

    <link rel="manifest" href="https://www.tensorflow.org/_pwa/tensorflow/manifest.json" crossorigin="use-credentials">
    <link rel="preconnect" href="https://www.gstatic.com/" crossorigin="">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="">
    <link rel="preconnect" href="https://fonts.googleapis.com/" crossorigin="">
    <link rel="preconnect" href="https://apis.google.com/" crossorigin="">
    <link rel="preconnect" href="https://www.google-analytics.com/" crossorigin=""><link rel="stylesheet" href="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/css.css">
      <link rel="stylesheet" href="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/css_002.css"><link rel="stylesheet" href="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/app.css">
      <link rel="shortcut icon" href="https://www.gstatic.com/devrel-devsite/prod/v6cd15f45ec209c8961e07ea7e57ed9a0e9da4333bc915e67d1fcd2b2a9ec62d1/tensorflow/images/favicon.png">
    <link rel="apple-touch-icon" href="https://www.gstatic.com/devrel-devsite/prod/v6cd15f45ec209c8961e07ea7e57ed9a0e9da4333bc915e67d1fcd2b2a9ec62d1/tensorflow/images/apple-touch-icon-180x180.png"><link rel="canonical" href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt"><link rel="search" type="application/opensearchdescription+xml" title="TensorFlow" href="https://www.tensorflow.org/s/opensearch.xml">
      

<title>TensorFlow Addons Networks : Sequence-to-Sequence NMT with Attention Mechanism</title>

<meta property="og:title" content="TensorFlow Addons Networks : Sequence-to-Sequence NMT with Attention Mechanism"><meta property="og:url" content="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt"><meta property="og:image" content="https://www.tensorflow.org/images/tf_logo_social.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="675"><meta property="og:locale" content="en"><meta name="twitter:card" content="summary_large_image"><script async="" src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/gtm.js" nonce=""></script><script async="" src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/app_loader.js"></script><script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [{
      "@type": "ListItem",
      "position": 1,
      "name": "Addons",
      "item": "https://www.tensorflow.org/addons"
    },{
      "@type": "ListItem",
      "position": 2,
      "name": "TensorFlow Addons Networks : Sequence-to-Sequence NMT with Attention Mechanism",
      "item": "https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt"
    }]
  }
  </script>
  

  

  


    
      <link rel="stylesheet" href="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/extras.css"><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_app_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_app_custom_elements_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_a11y_announce_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_analytics_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_badger_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_book_nav_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_bookmark_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_code_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_content_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_footer_linkboxes_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_footer_promos_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_footer_utility_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_header_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_heading_link_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_language_selector_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_notification_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_panel_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_progress_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_recommendations_sidebar_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_search_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_sitemask_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_snackbar_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_tabs_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_thumb_rating_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_toc_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_tooltip_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_user_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_badge_awarded_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_spinner_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_dialog_module.js" nonce=""></script><script src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/devsite_devsite_feedback_module.js" nonce=""></script><style type="text/css"></style></head>
  <body class="" template="page" theme="tensorflow-theme" type="article" layout="docs" style="--devsite-js-header-height: 157px;" ready="">
    <devsite-progress id="app-progress"></devsite-progress>
  
    <section class="devsite-wrapper"><devsite-header top-row--height="49" bottom-row--height="108" bottom-tabs--height="48" fixed="" offset="0">
  
    























<div class="devsite-header--inner nocontent">
  <div class="devsite-top-logo-row-wrapper-wrapper">
    <div class="devsite-top-logo-row-wrapper">
      <div class="devsite-top-logo-row">
        <button type="button" id="devsite-hamburger-menu" class="devsite-header-icon-button button-flat material-icons gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Navigation menu button" aria-label="Open menu">
        </button>
        <div class="devsite-product-name-wrapper">

  <a href="https://www.tensorflow.org/" class="devsite-site-logo-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Site logo" track-type="globalNav" track-name="tensorflow" track-metadata-position="nav" track-metadata-eventdetail="nav">

  
    <img src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/lockup.svg" class="devsite-site-logo" alt="TensorFlow">
  

</a>



  
  
  <span class="devsite-product-name">
    <ul class="devsite-breadcrumb-list">
  
  <li class="devsite-breadcrumb-item
             ">
    
    
    
      
      
    
  </li>
  
</ul>
  </span>

</div>
        <div class="devsite-top-logo-row-middle">
          <div class="devsite-header-upper-tabs">
            
              
              
  <devsite-tabs class="upper-tabs" connected="">

    

  <nav class="devsite-tabs-wrapper" aria-label="Upper tabs">
      
        
          <tab>
            <a href="https://www.tensorflow.org/install" class="gc-analytics-event " track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/install" track-metadata-position="nav - install" track-metadata-module="primary nav" data-category="Site-Wide Custom Events" data-label="Tab: Install" track-name="install">
  Install
</a>

          </tab>
        
      
        
          <tab dropdown="">
  <a href="https://www.tensorflow.org/learn" class="gc-analytics-event " track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/learn" track-metadata-position="nav - learn" track-metadata-module="primary nav" data-category="Site-Wide Custom Events" data-label="Tab: Learn" track-name="learn">
  Learn
</a>

  <a href="#" role="button" aria-haspopup="true" aria-expanded="false" aria-label="Dropdown menu for Learn" track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/learn" track-metadata-position="nav - learn" track-metadata-module="primary nav" data-category="Site-Wide Custom Events" data-label="Tab: Learn" track-name="learn" class="devsite-tabs-dropdown-toggle devsite-icon devsite-icon-arrow-drop-down"></a>

  <div class="devsite-tabs-dropdown" aria-label="submenu" hidden="">
    
    <div class="devsite-tabs-dropdown-content">
      
        <div class="devsite-tabs-dropdown-column
                    tfo-menu-column-learn">
          
            <ul class="devsite-tabs-dropdown-section
                       ">
              
              
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/learn" track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/learn" track-metadata-position="nav - learn" track-metadata-module="tertiary nav" tooltip="">
                    
                    <div class="devsite-nav-item-title">
                      Introduction
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      New to TensorFlow?
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/overview" track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/overview" track-metadata-position="nav - learn" track-metadata-module="tertiary nav" tooltip="">
                    
                    <div class="devsite-nav-item-title">
                      TensorFlow
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      The core open source ML library
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/js" track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/js" track-metadata-position="nav - learn" track-metadata-module="tertiary nav" tooltip="">
                    
                    <div class="devsite-nav-item-title">
                      For JavaScript
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      TensorFlow.js for ML using JavaScript
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/lite" track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/lite" track-metadata-position="nav - learn" track-metadata-module="tertiary nav" tooltip="">
                    
                    <div class="devsite-nav-item-title">
                      For Mobile &amp; Edge
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      TensorFlow Lite for mobile and edge devices
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/tfx" track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/tfx" track-metadata-position="nav - learn" track-metadata-module="tertiary nav" tooltip="">
                    
                    <div class="devsite-nav-item-title">
                      For Production
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      TensorFlow Extended for end-to-end ML components
                    </div>
                    
                  </a>
                </li>
              
            </ul>
          
        </div>
      
    </div>
  </div>
</tab>
        
      
        
          <tab dropdown="">
  <a href="https://www.tensorflow.org/api" class="gc-analytics-event " track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/api" track-metadata-position="nav - api" track-metadata-module="primary nav" data-category="Site-Wide Custom Events" data-label="Tab: API" track-name="api">
  API
</a>

  <a href="#" role="button" aria-haspopup="true" aria-expanded="false" aria-label="Dropdown menu for API" track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/api" track-metadata-position="nav - api" track-metadata-module="primary nav" data-category="Site-Wide Custom Events" data-label="Tab: API" track-name="api" class="devsite-tabs-dropdown-toggle devsite-icon devsite-icon-arrow-drop-down"></a>

  <div class="devsite-tabs-dropdown" aria-label="submenu" hidden="">
    
    <div class="devsite-tabs-dropdown-content">
      
        <div class="devsite-tabs-dropdown-column
                    ">
          
            <ul class="devsite-tabs-dropdown-section
                       ">
              
              
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/api/stable" track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/api/stable" track-metadata-position="nav - api" track-metadata-module="tertiary nav" tooltip="">
                    
                    <div class="devsite-nav-item-title">
                      TensorFlow (v2.8.0)
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/api/r1.15" track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/api/r1.15" track-metadata-position="nav - api" track-metadata-module="tertiary nav" tooltip="">
                    
                    <div class="devsite-nav-item-title">
                      r1.15
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/versions" track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/versions" track-metadata-position="nav - api" track-metadata-module="tertiary nav" tooltip="">
                    
                    <div class="devsite-nav-item-title">
                      Versions…
                    </div>
                    
                  </a>
                </li>
              
            </ul>
          
        </div>
      
        <div class="devsite-tabs-dropdown-column
                    ">
          
            <ul class="devsite-tabs-dropdown-section
                       ">
              
              
              
                <li class="devsite-nav-item">
                  <a href="https://js.tensorflow.org/api/latest/" track-type="nav" track-metadata-eventdetail="https://js.tensorflow.org/api/latest/" track-metadata-position="nav - api" track-metadata-module="tertiary nav" tooltip="">
                    
                    <div class="devsite-nav-item-title">
                      TensorFlow.js
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/lite/api_docs" track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/lite/api_docs" track-metadata-position="nav - api" track-metadata-module="tertiary nav" tooltip="">
                    
                    <div class="devsite-nav-item-title">
                      TensorFlow Lite
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/tfx/api_docs" track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/tfx/api_docs" track-metadata-position="nav - api" track-metadata-module="tertiary nav" tooltip="">
                    
                    <div class="devsite-nav-item-title">
                      TFX
                    </div>
                    
                  </a>
                </li>
              
            </ul>
          
        </div>
      
    </div>
  </div>
</tab>
        
      
        
          <tab dropdown="" active="">
  <a href="https://www.tensorflow.org/resources" class="gc-analytics-event " track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/resources" track-metadata-position="nav - resources" track-metadata-module="primary nav" aria-label="Resources, selected" data-category="Site-Wide Custom Events" data-label="Tab: Resources" track-name="resources">
  Resources
</a>

  <a href="#" role="button" aria-haspopup="true" aria-expanded="false" aria-label="Dropdown menu for Resources" track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/resources" track-metadata-position="nav - resources" track-metadata-module="primary nav" data-category="Site-Wide Custom Events" data-label="Tab: Resources" track-name="resources" class="devsite-tabs-dropdown-toggle devsite-icon devsite-icon-arrow-drop-down"></a>

  <div class="devsite-tabs-dropdown" aria-label="submenu" hidden="">
    
    <div class="devsite-tabs-dropdown-content">
      
        <div class="devsite-tabs-dropdown-column
                    ">
          
            <ul class="devsite-tabs-dropdown-section
                       ">
              
              
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/resources/models-datasets" track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/resources/models-datasets" track-metadata-position="nav - resources" track-metadata-module="tertiary nav" tooltip="">
                    
                    <div class="devsite-nav-item-title">
                      Models &amp; datasets
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      Pre-trained models and datasets built by Google and the community
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/resources/tools" track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/resources/tools" track-metadata-position="nav - resources" track-metadata-module="tertiary nav" tooltip="">
                    
                    <div class="devsite-nav-item-title">
                      Tools
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      Ecosystem of tools to help you use TensorFlow
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/resources/libraries-extensions" track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/resources/libraries-extensions" track-metadata-position="nav - resources" track-metadata-module="tertiary nav" tooltip="">
                    
                    <div class="devsite-nav-item-title">
                      Libraries &amp; extensions
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      Libraries and extensions built on TensorFlow
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/certificate" track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/certificate" track-metadata-position="nav - resources" track-metadata-module="tertiary nav" tooltip="">
                    
                    <div class="devsite-nav-item-title">
                      TensorFlow Certificate program
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      Differentiate yourself by demonstrating your ML proficiency
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/resources/learn-ml" track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/resources/learn-ml" track-metadata-position="nav - resources" track-metadata-module="tertiary nav" tooltip="">
                    
                    <div class="devsite-nav-item-title">
                      Learn ML
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      Educational resources to learn the fundamentals of ML with TensorFlow
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/responsible_ai" track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/responsible_ai" track-metadata-position="nav - resources" track-metadata-module="tertiary nav" tooltip="">
                    
                    <div class="devsite-nav-item-title">
                      Responsible AI
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      Resources and tools to integrate Responsible AI practices into your ML workflow
                    </div>
                    
                  </a>
                </li>
              
            </ul>
          
        </div>
      
    </div>
  </div>
</tab>
        
      
        
          <tab dropdown="">
  <a href="https://www.tensorflow.org/community" class="gc-analytics-event " track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/community" track-metadata-position="nav - community" track-metadata-module="primary nav" data-category="Site-Wide Custom Events" data-label="Tab: Community" track-name="community">
  Community
</a>

  <a href="#" role="button" aria-haspopup="true" aria-expanded="false" aria-label="Dropdown menu for Community" track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/community" track-metadata-position="nav - community" track-metadata-module="primary nav" data-category="Site-Wide Custom Events" data-label="Tab: Community" track-name="community" class="devsite-tabs-dropdown-toggle devsite-icon devsite-icon-arrow-drop-down"></a>

  <div class="devsite-tabs-dropdown" aria-label="submenu" hidden="">
    
    <div class="devsite-tabs-dropdown-content">
      
        <div class="devsite-tabs-dropdown-column
                    ">
          
            <ul class="devsite-tabs-dropdown-section
                       ">
              
              
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/community" track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/community" track-metadata-position="nav - community" track-metadata-module="tertiary nav" tooltip="">
                    
                    <div class="devsite-nav-item-title">
                      Join
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      Explore ways to get involved
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://blog.tensorflow.org/" track-type="nav" track-metadata-eventdetail="https://blog.tensorflow.org/" track-metadata-position="nav - community" track-metadata-module="tertiary nav" tooltip="">
                    
                    <div class="devsite-nav-item-title">
                      Blog
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      Stay up to date with all things TensorFlow
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://discuss.tensorflow.org/" track-type="nav" track-metadata-eventdetail="https://discuss.tensorflow.org" track-metadata-position="nav - community" track-metadata-module="tertiary nav" tooltip="">
                    
                    <div class="devsite-nav-item-title">
                      Forum ↗
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      Discussion platform for the TensorFlow community
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/community/groups" track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/community/groups" track-metadata-position="nav - community" track-metadata-module="tertiary nav" tooltip="">
                    
                    <div class="devsite-nav-item-title">
                      Groups
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      User groups, interest groups and mailing lists
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/community/contribute" track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/community/contribute" track-metadata-position="nav - community" track-metadata-module="tertiary nav" tooltip="">
                    
                    <div class="devsite-nav-item-title">
                      Contribute
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      Guide for contributing to code and documentation
                    </div>
                    
                  </a>
                </li>
              
            </ul>
          
        </div>
      
    </div>
  </div>
</tab>
        
      
        
          <tab dropdown="">
  <a href="https://www.tensorflow.org/about" class="gc-analytics-event " track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/about" track-metadata-position="nav - why tensorflow" track-metadata-module="primary nav" data-category="Site-Wide Custom Events" data-label="Tab: Why TensorFlow" track-name="why tensorflow">
  Why TensorFlow
</a>

  <a href="#" role="button" aria-haspopup="true" aria-expanded="false" aria-label="Dropdown menu for Why TensorFlow" track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/about" track-metadata-position="nav - why tensorflow" track-metadata-module="primary nav" data-category="Site-Wide Custom Events" data-label="Tab: Why TensorFlow" track-name="why tensorflow" class="devsite-tabs-dropdown-toggle devsite-icon devsite-icon-arrow-drop-down"></a>

  <div class="devsite-tabs-dropdown" aria-label="submenu" hidden="">
    
    <div class="devsite-tabs-dropdown-content">
      
        <div class="devsite-tabs-dropdown-column
                    ">
          
            <ul class="devsite-tabs-dropdown-section
                       ">
              
              
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/about" track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/about" track-metadata-position="nav - why tensorflow" track-metadata-module="tertiary nav" tooltip="">
                    
                    <div class="devsite-nav-item-title">
                      About
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/about/case-studies" track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/about/case-studies" track-metadata-position="nav - why tensorflow" track-metadata-module="tertiary nav" tooltip="">
                    
                    <div class="devsite-nav-item-title">
                      Case studies
                    </div>
                    
                  </a>
                </li>
              
            </ul>
          
        </div>
      
    </div>
  </div>
</tab>
        
      
    <tab overflow-tab="" hidden=""><a href="#" class="devsite-icon devsite-icon-arrow-drop-down">More</a><div class="devsite-tabs-overflow-menu" scrollbars="" hidden=""></div></tab></nav></devsite-tabs>

            
           </div>
          
<devsite-search aria-expanded="false" aria-haspopup="listbox" enable-signin="" enable-search="" enable-suggestions="" enable-query-completion="" project-name="TensorFlow Addons" tenant-name="TensorFlow" role="combobox">
  <form class="devsite-search-form" action="https://www.tensorflow.org/s/results" method="GET">
    <div class="devsite-search-container">
      <div class="devsite-searchbox">
        <input aria-activedescendant="" aria-autocomplete="list" aria-label="Search" aria-haspopup="false" aria-multiline="false" autocomplete="off" class="devsite-search-field devsite-search-query" name="q" placeholder="Search" role="searchbox" type="text" aria-controls="devsite-search-popout-container-id-1">
        <div class="devsite-search-image material-icons" aria-hidden="true"></div>
      </div>
      <button type="button" search-open="" class="devsite-search-button devsite-header-icon-button button-flat material-icons" aria-label="Open search"></button>
    </div>
  <div class="devsite-popout" id="devsite-search-popout-container-id-1"><div class="devsite-popout-result devsite-suggest-results-container" devsite-hide=""></div></div></form>
  <button type="button" search-close="" class="devsite-search-button devsite-header-icon-button button-flat material-icons" aria-label="Close search"></button>
</devsite-search>

        <div class="devsite-search-background" style="opacity: 1;"></div></div>

        

        

        

        
<devsite-language-selector>
  <ul>
    
    
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=en" aria-current="true" lang="en">English</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=id" lang="id">Bahasa Indonesia</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=es_419" lang="es_419">Español – América Latina</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=fr" lang="fr">Français</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=it" lang="it">Italiano</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=pl" lang="pl">Polski</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=pt_br" lang="pt_br">Português – Brasil</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=vi" lang="vi">Tiếng Việt</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=tr" lang="tr">Türkçe</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=ru" lang="ru">Русский</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=he" lang="he">עברית</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=ar" lang="ar">العربيّة</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=fa" lang="fa">فارسی</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=hi" lang="hi">हिंदी</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=bn" lang="bn">বাংলা</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=th" lang="th">ภาษาไทย</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=zh_cn" lang="zh_cn">中文 – 简体</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=ja" lang="ja">日本語</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=ko" lang="ko">한국어</a>
    </li>
    
  </ul>
</devsite-language-selector>


        
          
  <a class="devsite-header-link devsite-top-button button gc-analytics-event" href="https://github.com/tensorflow" data-category="Site-Wide Custom Events" data-label="Site header link">
    GitHub
  </a>
  
        

        
          
          
          <devsite-user enable-profiles="" id="devsite-user" sign-in-url="https://www.tensorflow.org/_d/signin?continue=https%3A%2F%2Fwww.tensorflow.org%2Faddons%2Ftutorials%2Fnetworks_seq2seq_nmt%23restore_the_latest_checkpoint_and_test&amp;prompt=select_account" sign-out-url="https://www.tensorflow.org/_d/signout?continue=https%3A%2F%2Fwww.tensorflow.org%2Faddons%2Ftutorials%2Fnetworks_seq2seq_nmt%23restore_the_latest_checkpoint_and_test" url="https://www.tensorflow.org/_d/signout?continue=https%3A%2F%2Fwww.tensorflow.org%2Faddons%2Ftutorials%2Fnetworks_seq2seq_nmt%23restore_the_latest_checkpoint_and_test"><div class="ogb-wrapper ogb-si"><a href="https://www.tensorflow.org/_d/signin?continue=https%3A%2F%2Fwww.tensorflow.org%2Faddons%2Ftutorials%2Fnetworks_seq2seq_nmt%23restore_the_latest_checkpoint_and_test&amp;prompt=select_account" class="devsite-user-signin button devsite-top-button" track-type="globalNav" track-name="signIn" track-metadata-eventdetail="nav" track-metadata-position="nav">
  Sign in
</a></div></devsite-user>
           
        
      </div>
    </div>
  </div>



  <div class="devsite-collapsible-section
    " style="transform: translate3d(0px, 0px, 0px);">
    <div class="devsite-header-background">
      
        
          <div class="devsite-product-id-row">
            <div class="devsite-product-description-row">
              
                
                  
                  
                  <ul class="devsite-breadcrumb-list">
  
  <li class="devsite-breadcrumb-item
             ">
    
    
    
      
  <a href="https://www.tensorflow.org/addons" class="devsite-breadcrumb-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Lower Header" data-value="1" track-type="globalNav" track-name="breadcrumb" track-metadata-position="1" track-metadata-eventdetail="TensorFlow Addons">
    
        Addons
      
  </a>
  
    
  </li>
  
</ul>
                
              
              
            </div>
            
          </div>
          
        
      
      
        <div class="devsite-doc-set-nav-row">
          
          
            
            
  <devsite-tabs class="lower-tabs" connected="">

    

  <nav class="devsite-tabs-wrapper" aria-label="Lower tabs">
      
        
          <tab>
            <a href="https://www.tensorflow.org/addons" class="gc-analytics-event " track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/addons" track-metadata-position="nav - overview" track-metadata-module="primary nav" data-category="Site-Wide Custom Events" data-label="Tab: Overview" track-name="overview">
  Overview
</a>

          </tab>
        
      
        
          <tab active="">
            <a href="https://www.tensorflow.org/addons/overview" class="gc-analytics-event " track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/addons/overview" track-metadata-position="nav - guide &amp; tutorials" track-metadata-module="primary nav" aria-label="Guide &amp; Tutorials, selected" data-category="Site-Wide Custom Events" data-label="Tab: Guide &amp; Tutorials" track-name="guide &amp; tutorials">
  Guide &amp; Tutorials
</a>

          </tab>
        
      
        
          <tab>
            <a href="https://www.tensorflow.org/addons/api_docs/python/tfa" class="gc-analytics-event " track-type="nav" track-metadata-eventdetail="https://www.tensorflow.org/addons/api_docs/python/tfa" track-metadata-position="nav - api" track-metadata-module="primary nav" data-category="Site-Wide Custom Events" data-label="Tab: API" track-name="api">
  API
</a>

          </tab>
        
      
    <tab overflow-tab="" hidden=""><a href="#" class="devsite-icon devsite-icon-arrow-drop-down">More</a><div class="devsite-tabs-overflow-menu" scrollbars="" hidden=""></div></tab></nav></devsite-tabs>

          
          
        </div>
      
    </div>
  </div>

</div>



  

  
</devsite-header>
      <div class="devsite-book-nav-bg" fixed=""></div><devsite-book-nav scrollbars="" fixed="" style="top: 157px; max-height: 790px; --devsite-js-book-nav-y-offset: 0px;">
        
          





















<div class="devsite-book-nav-filter
            ">
  <input type="text" placeholder="Filter" aria-label="Type to filter" role="searchbox">
  
  <span class="filter-clear-button hidden" data-title="Clear filter" aria-label="Clear filter" role="button" tabindex="0"></span>
</div>

<nav class="devsite-book-nav devsite-nav nocontent" aria-label="Side menu">
  <div class="devsite-mobile-header">
    <button type="button" id="devsite-close-nav" class="devsite-header-icon-button button-flat material-icons gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Close navigation" aria-label="Close navigation">
    </button>
    <div class="devsite-product-name-wrapper">

  <a href="https://www.tensorflow.org/" class="devsite-site-logo-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Site logo" track-type="globalNav" track-name="tensorflow" track-metadata-position="nav" track-metadata-eventdetail="nav">

  
    <img src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/lockup.svg" class="devsite-site-logo" alt="TensorFlow">
  

</a>


  
      <span class="devsite-product-name">
        
        
        <ul class="devsite-breadcrumb-list">
  
  <li class="devsite-breadcrumb-item
             ">
    
    
    
      
      
    
  </li>
  
</ul>
      </span>
    

</div>
  </div>

  <div class="devsite-book-nav-wrapper">
    <div class="devsite-mobile-nav-top">
      
        <ul class="devsite-nav-list">
          
            <li class="devsite-nav-item">
              
  
  <a href="https://www.tensorflow.org/install" class="devsite-nav-title gc-analytics-event
              devsite-nav-has-children
              " data-category="Site-Wide Custom Events" data-label="Tab: Install" track-name="install" track-type="globalNav" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      Install
   </span>
    
    <span class="devsite-nav-icon material-icons" data-icon="forward">
    </span>
    
  
  </a>
  

  
              
            </li>
          
            <li class="devsite-nav-item">
              
  
  <a href="https://www.tensorflow.org/learn" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Tab: Learn" track-name="learn" track-type="globalNav" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      Learn
   </span>
    
  
  </a>
  

  
    <ul class="devsite-nav-responsive-tabs devsite-nav-has-menu
               ">
      
<li class="devsite-nav-item">

  
  <span class="devsite-nav-title" tooltip="" data-category="Site-Wide Custom Events" data-label="Tab: Learn" track-name="learn">
  
    <span class="devsite-nav-text" tooltip="" menu="Learn">
      More
   </span>
    
    <span class="devsite-nav-icon material-icons" data-icon="forward" menu="Learn">
    </span>
    
  
  </span>
  

</li>

    </ul>
  
              
            </li>
          
            <li class="devsite-nav-item">
              
  
  <a href="https://www.tensorflow.org/api" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Tab: API" track-name="api" track-type="globalNav" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      API
   </span>
    
  
  </a>
  

  
    <ul class="devsite-nav-responsive-tabs devsite-nav-has-menu
               ">
      
<li class="devsite-nav-item">

  
  <span class="devsite-nav-title" tooltip="" data-category="Site-Wide Custom Events" data-label="Tab: API" track-name="api">
  
    <span class="devsite-nav-text" tooltip="" menu="API">
      More
   </span>
    
    <span class="devsite-nav-icon material-icons" data-icon="forward" menu="API">
    </span>
    
  
  </span>
  

</li>

    </ul>
  
              
            </li>
          
            <li class="devsite-nav-item">
              
  
  <a href="https://www.tensorflow.org/resources" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Tab: Resources" track-name="resources" track-type="globalNav" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      Resources
   </span>
    
  
  </a>
  

  
    <ul class="devsite-nav-responsive-tabs devsite-nav-has-menu
               ">
      
<li class="devsite-nav-item">

  
  <span class="devsite-nav-title" tooltip="" data-category="Site-Wide Custom Events" data-label="Tab: Resources" track-name="resources">
  
    <span class="devsite-nav-text" tooltip="" menu="Resources">
      More
   </span>
    
    <span class="devsite-nav-icon material-icons" data-icon="forward" menu="Resources">
    </span>
    
  
  </span>
  

</li>

    </ul>
  
              
                <ul class="devsite-nav-responsive-tabs">
                  
                    
                    
                    
                    <li class="devsite-nav-item">
                      
  
  <a href="https://www.tensorflow.org/addons" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Tab: Overview" track-name="overview" track-type="globalNav" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      Overview
   </span>
    
  
  </a>
  

  
                    </li>
                  
                    
                    
                    
                    <li class="devsite-nav-item">
                      
  
  <a href="https://www.tensorflow.org/addons/overview" class="devsite-nav-title gc-analytics-event devsite-nav-has-children" data-category="Site-Wide Custom Events" data-label="Tab: Guide &amp; Tutorials" track-name="guide &amp; tutorials" track-type="globalNav" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="" menu="_book">
      Guide &amp; Tutorials
   </span>
    
    <span class="devsite-nav-icon material-icons" data-icon="forward" menu="_book">
    </span>
    
  
  </a>
  

  
                    </li>
                  
                    
                    
                    
                    <li class="devsite-nav-item">
                      
  
  <a href="https://www.tensorflow.org/addons/api_docs/python/tfa" class="devsite-nav-title gc-analytics-event
              devsite-nav-has-children
              " data-category="Site-Wide Custom Events" data-label="Tab: API" track-name="api" track-type="globalNav" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      API
   </span>
    
    <span class="devsite-nav-icon material-icons" data-icon="forward">
    </span>
    
  
  </a>
  

  
                    </li>
                  
                </ul>
              
            </li>
          
            <li class="devsite-nav-item">
              
  
  <a href="https://www.tensorflow.org/community" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Tab: Community" track-name="community" track-type="globalNav" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      Community
   </span>
    
  
  </a>
  

  
    <ul class="devsite-nav-responsive-tabs devsite-nav-has-menu
               ">
      
<li class="devsite-nav-item">

  
  <span class="devsite-nav-title" tooltip="" data-category="Site-Wide Custom Events" data-label="Tab: Community" track-name="community">
  
    <span class="devsite-nav-text" tooltip="" menu="Community">
      More
   </span>
    
    <span class="devsite-nav-icon material-icons" data-icon="forward" menu="Community">
    </span>
    
  
  </span>
  

</li>

    </ul>
  
              
            </li>
          
            <li class="devsite-nav-item">
              
  
  <a href="https://www.tensorflow.org/about" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Tab: Why TensorFlow" track-name="why tensorflow" track-type="globalNav" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      Why TensorFlow
   </span>
    
  
  </a>
  

  
    <ul class="devsite-nav-responsive-tabs devsite-nav-has-menu
               ">
      
<li class="devsite-nav-item">

  
  <span class="devsite-nav-title" tooltip="" data-category="Site-Wide Custom Events" data-label="Tab: Why TensorFlow" track-name="why tensorflow">
  
    <span class="devsite-nav-text" tooltip="" menu="Why TensorFlow">
      More
   </span>
    
    <span class="devsite-nav-icon material-icons" data-icon="forward" menu="Why TensorFlow">
    </span>
    
  
  </span>
  

</li>

    </ul>
  
              
            </li>
          
          
    
<li class="devsite-nav-item">

  
  <a href="https://github.com/tensorflow" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: GitHub" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      GitHub
   </span>
    
  
  </a>
  

</li>

  
          
        </ul>
      
    </div>
    
      <div class="devsite-mobile-nav-bottom" role="navigation">
        
          
          <ul class="devsite-nav-list" menu="_book">
            <li class="devsite-nav-item"><a href="https://www.tensorflow.org/addons/overview" class="devsite-nav-title"><span class="devsite-nav-text" tooltip="">Overview</span></a></li>

  <li class="devsite-nav-item
           devsite-nav-heading"><div class="devsite-nav-title devsite-nav-title-no-path">
        <span class="devsite-nav-text" tooltip="">Tutorials</span>
      </div></li>

  <li class="devsite-nav-item"><a href="https://www.tensorflow.org/addons/tutorials/losses_triplet" class="devsite-nav-title"><span class="devsite-nav-text" tooltip="">Triplet loss</span></a></li>

  <li class="devsite-nav-item"><a href="https://www.tensorflow.org/addons/tutorials/image_ops" class="devsite-nav-title"><span class="devsite-nav-text" tooltip="">Image Ops</span></a></li>

  <li class="devsite-nav-item"><a href="https://www.tensorflow.org/addons/tutorials/layers_normalizations" class="devsite-nav-title"><span class="devsite-nav-text" tooltip="">Normalization layers</span></a></li>

  <li class="devsite-nav-item"><a href="https://www.tensorflow.org/addons/tutorials/layers_weightnormalization" class="devsite-nav-title"><span class="devsite-nav-text" tooltip="">Weight normalization layer</span></a></li>

  <li class="devsite-nav-item"><a href="https://www.tensorflow.org/addons/tutorials/optimizers_lazyadam" class="devsite-nav-title"><span class="devsite-nav-text" tooltip="">LazyAdam optimizer</span></a></li>

  <li class="devsite-nav-item"><a href="https://www.tensorflow.org/addons/tutorials/optimizers_conditionalgradient" class="devsite-nav-title"><span class="devsite-nav-text" tooltip="">ConditionalGradient Optimizer</span></a></li>

  <li class="devsite-nav-item"><a href="https://www.tensorflow.org/addons/tutorials/optimizers_cyclicallearningrate" class="devsite-nav-title"><span class="devsite-nav-text" tooltip="">CyclicalLearningRate Schedule</span></a></li>

  <li class="devsite-nav-item"><a href="https://www.tensorflow.org/addons/tutorials/tqdm_progress_bar" class="devsite-nav-title"><span class="devsite-nav-text" tooltip="">TQDM Progress Bar</span></a></li>

  <li class="devsite-nav-item"><a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt" class="devsite-nav-title devsite-nav-active"><span class="devsite-nav-text" tooltip="">Seq2Seq for Translation</span></a></li>

  <li class="devsite-nav-item"><a href="https://www.tensorflow.org/addons/tutorials/average_optimizers_callback" class="devsite-nav-title"><span class="devsite-nav-text" tooltip="">Moving Average Optimizer Checkpoint</span></a></li>

  <li class="devsite-nav-item"><a href="https://www.tensorflow.org/addons/tutorials/time_stopping" class="devsite-nav-title"><span class="devsite-nav-text" tooltip="">Time Stopping Callback</span></a></li>
          </ul>
        
        
          
    
  
    
      
      <ul class="devsite-nav-list" menu="Learn" aria-label="Side menu" hidden="">
        
          
            
            
              
<li class="devsite-nav-item">

  
  <a href="https://www.tensorflow.org/learn" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: Introduction" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      Introduction
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="https://www.tensorflow.org/overview" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: TensorFlow" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      TensorFlow
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="https://www.tensorflow.org/js" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: For JavaScript" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      For JavaScript
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="https://www.tensorflow.org/lite" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: For Mobile &amp; Edge" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      For Mobile &amp; Edge
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="https://www.tensorflow.org/tfx" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: For Production" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      For Production
   </span>
    
  
  </a>
  

</li>

            
          
        
      </ul>
    
  
    
      
      <ul class="devsite-nav-list" menu="API" aria-label="Side menu" hidden="">
        
          
            
            
              
<li class="devsite-nav-item">

  
  <a href="https://www.tensorflow.org/api/stable" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: TensorFlow (v2.8.0)" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      TensorFlow (v2.<wbr>8.<wbr>0)
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="https://www.tensorflow.org/api/r1.15" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: r1.15" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      r1.<wbr>15
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="https://www.tensorflow.org/versions" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: Versions…" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      Versions…
   </span>
    
  
  </a>
  

</li>

            
          
        
          
            
            
              
<li class="devsite-nav-item">

  
  <a href="https://js.tensorflow.org/api/latest/" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: TensorFlow.js" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      TensorFlow.<wbr>js
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="https://www.tensorflow.org/lite/api_docs" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: TensorFlow Lite" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      TensorFlow Lite
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="https://www.tensorflow.org/tfx/api_docs" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: TFX" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      TFX
   </span>
    
  
  </a>
  

</li>

            
          
        
      </ul>
    
  
    
      
      <ul class="devsite-nav-list" menu="Resources" aria-label="Side menu" hidden="">
        
          
            
            
              
<li class="devsite-nav-item">

  
  <a href="https://www.tensorflow.org/resources/models-datasets" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: Models &amp; datasets" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      Models &amp; datasets
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="https://www.tensorflow.org/resources/tools" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: Tools" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      Tools
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="https://www.tensorflow.org/resources/libraries-extensions" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: Libraries &amp; extensions" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      Libraries &amp; extensions
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="https://www.tensorflow.org/certificate" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: TensorFlow Certificate program" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      TensorFlow Certificate program
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="https://www.tensorflow.org/resources/learn-ml" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: Learn ML" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      Learn ML
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="https://www.tensorflow.org/responsible_ai" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: Responsible AI" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      Responsible AI
   </span>
    
  
  </a>
  

</li>

            
          
        
      </ul>
    
  
    
      
      <ul class="devsite-nav-list" menu="Community" aria-label="Side menu" hidden="">
        
          
            
            
              
<li class="devsite-nav-item">

  
  <a href="https://www.tensorflow.org/community" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: Join" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      Join
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="https://blog.tensorflow.org/" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: Blog" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      Blog
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="https://discuss.tensorflow.org/" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: Forum ↗" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      Forum ↗
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="https://www.tensorflow.org/community/groups" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: Groups" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      Groups
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="https://www.tensorflow.org/community/contribute" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: Contribute" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      Contribute
   </span>
    
  
  </a>
  

</li>

            
          
        
      </ul>
    
  
    
      
      <ul class="devsite-nav-list" menu="Why TensorFlow" aria-label="Side menu" hidden="">
        
          
            
            
              
<li class="devsite-nav-item">

  
  <a href="https://www.tensorflow.org/about" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: About" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      About
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="https://www.tensorflow.org/about/case-studies" class="devsite-nav-title gc-analytics-event
              
              " data-category="Site-Wide Custom Events" data-label="Responsive Tab: Case studies" track-type="navMenu" track-metadata-eventdetail="globalMenu" track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip="">
      Case studies
   </span>
    
  
  </a>
  

</li>

            
          
        
      </ul>
    
  
        
        
          
    
  
    
  
    
  
        
      </div>
    
  </div>
</nav>
        
      </devsite-book-nav><div class="devsite-book-nav-blur" fixed="" style="--devsite-js-book-nav-scrollbar-width: 0px;"></div><button class="devsite-book-nav-toggle" aria-haspopup="menu" fixed="" aria-label="Hide side navigation" data-title="Hide side navigation" aria-expanded="true"><span class="material-icons devsite-book-nav-toggle-icon"></span></button>
      <section id="gc-wrapper" style="margin-top: 157px;">
        <main role="main" class="devsite-main-content" has-book-nav="" has-sidebar="">
          
          <div class="devsite-sidebar" fixed="" style="--devsite-js-sidebar-max-height: 742px; --devsite-js-sidebar-max-width: 335.5px; --devsite-js-sidebar-offset: 0;">
            <div class="devsite-sidebar-content">
              <devsite-toc class="devsite-nav devsite-toc" role="navigation" aria-label="On this page" depth="2" scrollbars="" visible=""><ul class="devsite-nav-list"><li class="devsite-nav-item devsite-nav-heading devsite-toc-toggle" role="heading" aria-level="2"><span class="devsite-nav-title"><span class="devsite-nav-text">On this page</span></span></li><li class="devsite-nav-item"><a href="#overview" class="devsite-nav-title gc-analytics-event devsite-nav-active" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="0" track-type="navigation" track-name="rightNav" track-metadata-position="0" track-metadata-link-destination="#overview"><span class="devsite-nav-text" tooltip="">Overview</span></a></li><li class="devsite-nav-item"><a href="#setup" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="1" track-type="navigation" track-name="rightNav" track-metadata-position="1" track-metadata-link-destination="#setup"><span class="devsite-nav-text" tooltip="">Setup</span></a></li><li class="devsite-nav-item"><a href="#data_cleaning_and_data_preparation" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="2" track-type="navigation" track-name="rightNav" track-metadata-position="2" track-metadata-link-destination="#data_cleaning_and_data_preparation"><span class="devsite-nav-text" tooltip="">Data Cleaning and Data Preparation</span></a><ul class="devsite-nav-list"><li class="devsite-nav-item"><a href="#define_a_nmtdataset_class_with_necessary_functions_to_follow_step_1_to_step_4" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="2.0" track-type="navigation" track-name="rightNav" track-metadata-position="2.0" track-metadata-link-destination="#define_a_nmtdataset_class_with_necessary_functions_to_follow_step_1_to_step_4"><span class="devsite-nav-text" tooltip="">Define a NMTDataset class with necessary functions to follow Step 1 to Step 4.</span></a></li><li class="devsite-nav-item"><a href="#some_important_parameters" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="2.1" track-type="navigation" track-name="rightNav" track-metadata-position="2.1" track-metadata-link-destination="#some_important_parameters"><span class="devsite-nav-text" tooltip="">Some important parameters</span></a></li></ul></li><li class="devsite-nav-item"><a href="#define_the_optimizer_and_the_loss_function" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="3" track-type="navigation" track-name="rightNav" track-metadata-position="3" track-metadata-link-destination="#define_the_optimizer_and_the_loss_function"><span class="devsite-nav-text" tooltip="">Define the optimizer and the loss function</span></a></li><li class="devsite-nav-item"><a href="#checkpoints_object-based_saving" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="4" track-type="navigation" track-name="rightNav" track-metadata-position="4" track-metadata-link-destination="#checkpoints_object-based_saving"><span class="devsite-nav-text" tooltip="">Checkpoints (Object-based saving)</span></a></li><li class="devsite-nav-item"><a href="#one_train_step_operations" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="5" track-type="navigation" track-name="rightNav" track-metadata-position="5" track-metadata-link-destination="#one_train_step_operations"><span class="devsite-nav-text" tooltip="">One train_step operations</span></a></li><li class="devsite-nav-item"><a href="#train_the_model" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="6" track-type="navigation" track-name="rightNav" track-metadata-position="6" track-metadata-link-destination="#train_the_model"><span class="devsite-nav-text" tooltip="">Train the model</span></a></li><li class="devsite-nav-item"><a href="#use_tf-addons_basicdecoder_for_decoding" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="7" track-type="navigation" track-name="rightNav" track-metadata-position="7" track-metadata-link-destination="#use_tf-addons_basicdecoder_for_decoding"><span class="devsite-nav-text" tooltip="">Use tf-addons BasicDecoder for decoding</span></a></li><li class="devsite-nav-item"><a href="#restore_the_latest_checkpoint_and_test" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="8" track-type="navigation" track-name="rightNav" track-metadata-position="8" track-metadata-link-destination="#restore_the_latest_checkpoint_and_test"><span class="devsite-nav-text" tooltip="">Restore the latest checkpoint and test</span></a></li><li class="devsite-nav-item"><a href="#use_tf-addons_beamsearchdecoder" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Right nav" data-value="9" track-type="navigation" track-name="rightNav" track-metadata-position="9" track-metadata-link-destination="#use_tf-addons_beamsearchdecoder"><span class="devsite-nav-text" tooltip="">Use tf-addons BeamSearchDecoder</span></a></li></ul></devsite-toc>
              <devsite-recommendations-sidebar class="nocontent devsite-nav">
              </devsite-recommendations-sidebar>
            </div>
          </div>
          <devsite-content>
            
              

















<article class="devsite-article" has-bookmark=""><style>
      /* Styles inlined from /site-assets/css/style.css */
/* override theme */
table img {
  max-width: 100%;
}

/* .devsite-terminal virtualenv prompt */
.tfo-terminal-venv::before {
  content: "(venv) $ " !important;
}

/* .devsite-terminal root prompt */
.tfo-terminal-root::before {
  content: "# " !important;
}

/* Used in links for type annotations in function/method signatures */
.tfo-signature-link a,
.tfo-signature-link a:visited,
.tfo-signature-link a:hover,
.tfo-signature-link a:focus,
.tfo-signature-link a:hover *,
.tfo-signature-link a:focus * {
  text-decoration: none !important;
}

.tfo-signature-link a,
.tfo-signature-link a:visited {
  border-bottom: 1px dotted #1a73e8;
}

.tfo-signature-link a:focus {
  border-bottom-style: solid;
}

/* .devsite-terminal Windows prompt */
.tfo-terminal-windows::before {
  content: "C:\\> " !important;
}

/* .devsite-terminal Windows prompt w/ virtualenv */
.tfo-terminal-windows-venv::before {
  content: "(venv) C:\\> " !important;
}

.tfo-diff-green-one-level + * {
  background: rgba(175, 245, 162, .6)  !important;
}

.tfo-diff-green + * > * {
  background: rgba(175, 245, 162, .6)  !important;
}

.tfo-diff-green-list + ul > li:first-of-type {
  background: rgba(175, 245, 162, .6)  !important;
}

.tfo-diff-red-one-level + * {
  background: rgba(255, 230, 230, .6)  !important;
  text-decoration: line-through  !important;
}

.tfo-diff-red + * > * {
  background: rgba(255, 230, 230, .6)  !important;
  text-decoration: line-through  !important;
}

.tfo-diff-red-list + ul > li:first-of-type {
  background: rgba(255, 230, 230, .6)  !important;
  text-decoration: line-through  !important;
}

devsite-code .tfo-notebook-code-cell-output {
  max-height: 300px;
  overflow: auto;
  background: rgba(255, 247, 237, 1);  /* orange bg to distinguish from input code cells */
}

devsite-code .tfo-notebook-code-cell-output + .devsite-code-buttons-container button {
  background: rgba(255, 247, 237, .7);  /* orange bg to distinguish from input code cells */
}

devsite-code[dark-code] .tfo-notebook-code-cell-output {
  background: rgba(64, 78, 103, 1);  /* medium slate */
}

devsite-code[dark-code] .tfo-notebook-code-cell-output + .devsite-code-buttons-container button {
  background: rgba(64, 78, 103, .7);  /* medium slate */
}

/* override default table styles for notebook buttons */
.devsite-table-wrapper .tfo-notebook-buttons {
  display: inline-block;
  margin-left: 3px;
  width: auto;
}

.tfo-notebook-buttons td {
  padding-left: 0;
  padding-right: 20px;
}

.tfo-notebook-buttons a,
.tfo-notebook-buttons :link,
.tfo-notebook-buttons :visited {
  border-radius: 8px;
  box-shadow: 0 1px 2px 0 rgba(60, 64, 67, .3), 0 1px 3px 1px rgba(60, 64, 67, .15);
  color: #202124;
  padding: 12px 17px;
  transition: box-shadow 0.2s;
}

.tfo-notebook-buttons a:hover,
.tfo-notebook-buttons a:focus {
  box-shadow: 0 1px 2px 0 rgba(60, 64, 67, .3), 0 2px 6px 2px rgba(60, 64, 67, .15);
}

.tfo-notebook-buttons tr {
  background: 0;
  border: 0;
}

/* on rendered notebook page,
   remove link to webpage since we're already here */
.tfo-notebook-buttons:not(.tfo-api) td:first-child {
  display: none;
}

.tfo-notebook-buttons td > a {
  -webkit-box-align: center;
  -ms-flex-align: center;
  align-items: center;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.tfo-notebook-buttons td > a > img {
  margin-right: 8px;
}

/* landing pages */

.tfo-landing-row-item-inset-white {
  background-color: #fff;
  padding: 32px;
}

.tfo-landing-row-item-inset-white ol,
.tfo-landing-row-item-inset-white ul {
  padding-left: 20px;
}

/* colab callout button */
.colab-callout-row devsite-code {
  border-radius: 8px 8px 0 0;
  box-shadow: none;
}

.colab-callout-footer {
  background: #e3e4e7;
  border-radius: 0 0 8px 8px;
  color: #37474f;
  padding: 20px;
}

.colab-callout-row devsite-code[dark-code] + .colab-callout-footer {
  background: #3f4f66;
}


.colab-callout-footer > .button {
  margin-top: 4px;
  color: #ff5c00;
}

.colab-callout-footer > a > span {
  padding-top: 10px;
  vertical-align: middle;
  color: #37474f;
  padding-left: 10px;
  padding-right: 10px;
  font-size: 14px;
}

.colab-callout-row devsite-code[dark-code] + .colab-callout-footer > a > span {
  color: #fff;
}

a.colab-button {
  background: rgba(255, 255, 255, .75);
  border: solid 1px rgba(0, 0, 0, .08);
  border-bottom-color: rgba(0, 0, 0, .15);
  border-radius: 4px;
  color: #aaa;
  display: inline-block;
  font-size: 11px !important;
  font-weight: 300;
  line-height: 16px;
  padding: 4px 8px;
  text-decoration: none;
  text-transform: uppercase;
}

a.colab-button:hover {
  background: white;
  border-color: rgba(0, 0, 0, .2);
  color: #666;
}

a.colab-button span {
  background: url(/images/colab_logo_button.svg) no-repeat 1px 1px / 20px;
  border-radius: 4px;
  display: inline-block;
  padding-left: 24px;
  text-decoration: none;
}

@media screen and (max-width: 600px) {
  .tfo-notebook-buttons td {
    display: block;
  }
}

/* guide and tutorials landing page cards and sections */

.tfo-landing-page-card {
  padding: 16px;
  box-shadow: 0 0 36px rgba(0,0,0,0.1);
  border-radius: 10px;
}

/* Page section headings */
.tfo-landing-page-heading h2, h2.tfo-landing-page-heading {
  font-family: "Google Sans", sans-serif;
  color: #425066;
  font-size: 30px;
  font-weight: 700;
  line-height: 40px;
}

/* Item title headings */
.tfo-landing-page-heading h3, h3.tfo-landing-page-heading,
.tfo-landing-page-card h3, h3.tfo-landing-page-card {
  font-family: "Google Sans", sans-serif;
  color: #425066;
  font-size: 20px;
  font-weight: 500;
  line-height: 26px;
}

/* List of tutorials notebooks for subsites */
.tfo-landing-page-resources-ul {
  padding-left: 15px
}

.tfo-landing-page-resources-ul > li {
  margin: 6px 0;
}

/* Temporary fix to hide product description in header on landing pages */
devsite-header .devsite-product-description {
  display: none;
}

      </style>
  
  
    <div class="devsite-banner devsite-banner-announcement">
      <div class="devsite-banner-message">
        <div class="devsite-banner-message-text">
          Join TensorFlow at Google I/O, May 11-12 <a href="https://io.google/2022/" target="_blank" rel="noopener" data-category="Announcement" data-label="Join TensorFlow at Google" class="button button-primary button-tfo-announcement"> Register now</a>

        </div>
      </div>
    </div>
  
  

  <div class="devsite-article-meta nocontent" role="navigation">
    
    
    <ul class="devsite-breadcrumb-list" aria-label="Breadcrumb">
  
  <li class="devsite-breadcrumb-item
             ">
    
    
    
      
  <a href="https://www.tensorflow.org/" class="devsite-breadcrumb-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Breadcrumbs" data-value="1" track-type="globalNav" track-name="breadcrumb" track-metadata-position="1" track-metadata-eventdetail="TensorFlow">
    
        TensorFlow
      
  </a>
  
    
  </li>
  
  <li class="devsite-breadcrumb-item
             ">
    
      
      <div class="devsite-breadcrumb-guillemet material-icons" aria-hidden="true"></div>
    
    
    
      
  <a href="https://www.tensorflow.org/resources" class="devsite-breadcrumb-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Breadcrumbs" data-value="2" track-type="globalNav" track-name="breadcrumb" track-metadata-position="2" track-metadata-eventdetail="">
    
        Resources
      
  </a>
  
    
  </li>
  
  <li class="devsite-breadcrumb-item
             ">
    
      
      <div class="devsite-breadcrumb-guillemet material-icons" aria-hidden="true"></div>
    
    
    
      
  <a href="https://www.tensorflow.org/addons" class="devsite-breadcrumb-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Breadcrumbs" data-value="3" track-type="globalNav" track-name="breadcrumb" track-metadata-position="3" track-metadata-eventdetail="TensorFlow Addons">
    
        Addons
      
  </a>
  
    
  </li>
  
  <li class="devsite-breadcrumb-item
             ">
    
      
      <div class="devsite-breadcrumb-guillemet material-icons" aria-hidden="true"></div>
    
    
    
      
  <a href="https://www.tensorflow.org/addons/overview" class="devsite-breadcrumb-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Breadcrumbs" data-value="4" track-type="globalNav" track-name="breadcrumb" track-metadata-position="4" track-metadata-eventdetail="">
    
        Guide &amp; Tutorials
      
  </a>
  
    
  </li>
  
</ul>
    
      
    <devsite-thumb-rating position="header"><div class="devsite-thumb-rating" role="form" aria-labelledby="devsite-thumb-label-header" tabindex="0"><div class="devsite-thumb-label" id="devsite-thumb-label-header">Was this helpful?</div><div class="devsite-thumbs"><button class="devsite-thumb devsite-thumb-up" data-title="Helpful" aria-label="Helpful"><svg class="devsite-thumb-icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M21,7h-6.31l0.95-4.57l0.03-0.32c0-0.41-0.17-0.79-0.44-1.06L14.17,0c0,0-7.09,6.85-7.17,7H2v13h16 c0.83,0,1.54-0.5,1.84-1.22l3.02-7.05C22.95,11.5,23,11.26,23,11V9C23,7.9,22.1,7,21,7z M7,18H4V9h3V18z M21,11l-3,7H9V8l4.34-4.34 L12,9h9V11z"></path></svg></button><button class="devsite-thumb devsite-thumb-down" data-title="Not helpful" aria-label="Not helpful"><svg class="devsite-thumb-icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M3,17h6.31l-0.95,4.57l-0.03,0.32c0,0.41,0.17,0.79,0.44,1.06L9.83,24c0,0,7.09-6.85,7.17-7h5V4H6 C5.17,4,4.46,4.5,4.16,5.22l-3.02,7.05C1.05,12.5,1,12.74,1,13v2C1,16.1,1.9,17,3,17z M17,6h3v9h-3V6z M3,13l3-7h9v10l-4.34,4.34 L12,15H3V13z"></path></svg></button></div></div></devsite-thumb-rating>
  
    
  </div>
  
  
    <h1 class="devsite-page-title">TensorFlow Addons Networks : Sequence-to-Sequence NMT with Attention Mechanism</h1>
  
  <devsite-bookmark class="show" data-title="Add bookmark"><input type="checkbox" class="bookmark-checkbox" aria-label="Add bookmark"></devsite-bookmark>
  <devsite-toc class="devsite-nav devsite-toc-embedded" depth="2" devsite-toc-embedded="" expandable="" visible=""><ul class="devsite-nav-list"><li class="devsite-nav-item devsite-nav-heading devsite-toc-toggle" role="heading" aria-level="2"><span class="devsite-nav-title"><span class="devsite-nav-text">On this page</span></span><button type="button" title="Expand/collapse contents" class="devsite-nav-show-all button-transparent material-icons"></button></li><li class="devsite-nav-item" visible=""><a href="#overview" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="0" track-type="navigation" track-name="embeddedNav" track-metadata-position="0" track-metadata-link-destination="#overview"><span class="devsite-nav-text" tooltip="">Overview</span></a></li><li class="devsite-nav-item" visible=""><a href="#setup" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="1" track-type="navigation" track-name="embeddedNav" track-metadata-position="1" track-metadata-link-destination="#setup"><span class="devsite-nav-text" tooltip="">Setup</span></a></li><li class="devsite-nav-item" visible=""><a href="#data_cleaning_and_data_preparation" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="2" track-type="navigation" track-name="embeddedNav" track-metadata-position="2" track-metadata-link-destination="#data_cleaning_and_data_preparation"><span class="devsite-nav-text" tooltip="">Data Cleaning and Data Preparation</span></a><ul class="devsite-nav-list"><li class="devsite-nav-item" visible=""><a href="#define_a_nmtdataset_class_with_necessary_functions_to_follow_step_1_to_step_4" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="2.0" track-type="navigation" track-name="embeddedNav" track-metadata-position="2.0" track-metadata-link-destination="#define_a_nmtdataset_class_with_necessary_functions_to_follow_step_1_to_step_4"><span class="devsite-nav-text" tooltip="">Define a NMTDataset class with necessary functions to follow Step 1 to Step 4.</span></a></li><li class="devsite-nav-item" visible=""><a href="#some_important_parameters" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="2.1" track-type="navigation" track-name="embeddedNav" track-metadata-position="2.1" track-metadata-link-destination="#some_important_parameters"><span class="devsite-nav-text" tooltip="">Some important parameters</span></a></li></ul></li><li class="devsite-nav-item"><a href="#define_the_optimizer_and_the_loss_function" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="3" track-type="navigation" track-name="embeddedNav" track-metadata-position="3" track-metadata-link-destination="#define_the_optimizer_and_the_loss_function"><span class="devsite-nav-text" tooltip="">Define the optimizer and the loss function</span></a></li><li class="devsite-nav-item"><a href="#checkpoints_object-based_saving" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="4" track-type="navigation" track-name="embeddedNav" track-metadata-position="4" track-metadata-link-destination="#checkpoints_object-based_saving"><span class="devsite-nav-text" tooltip="">Checkpoints (Object-based saving)</span></a></li><li class="devsite-nav-item"><a href="#one_train_step_operations" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="5" track-type="navigation" track-name="embeddedNav" track-metadata-position="5" track-metadata-link-destination="#one_train_step_operations"><span class="devsite-nav-text" tooltip="">One train_step operations</span></a></li><li class="devsite-nav-item"><a href="#train_the_model" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="6" track-type="navigation" track-name="embeddedNav" track-metadata-position="6" track-metadata-link-destination="#train_the_model"><span class="devsite-nav-text" tooltip="">Train the model</span></a></li><li class="devsite-nav-item"><a href="#use_tf-addons_basicdecoder_for_decoding" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="7" track-type="navigation" track-name="embeddedNav" track-metadata-position="7" track-metadata-link-destination="#use_tf-addons_basicdecoder_for_decoding"><span class="devsite-nav-text" tooltip="">Use tf-addons BasicDecoder for decoding</span></a></li><li class="devsite-nav-item"><a href="#restore_the_latest_checkpoint_and_test" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="8" track-type="navigation" track-name="embeddedNav" track-metadata-position="8" track-metadata-link-destination="#restore_the_latest_checkpoint_and_test"><span class="devsite-nav-text" tooltip="">Restore the latest checkpoint and test</span></a></li><li class="devsite-nav-item"><a href="#use_tf-addons_beamsearchdecoder" class="devsite-nav-title gc-analytics-event" data-category="Site-Wide Custom Events" data-action="click" data-label="Embedded nav" data-value="9" track-type="navigation" track-name="embeddedNav" track-metadata-position="9" track-metadata-link-destination="#use_tf-addons_beamsearchdecoder"><span class="devsite-nav-text" tooltip="">Use tf-addons BeamSearchDecoder</span></a></li><li class="devsite-toc-toggle"><button type="button" class="button-flat devsite-nav-more-items material-icons" track-type="navigation" track-name="embeddedNavExpand" title="Expand/collapse contents"></button></li></ul></devsite-toc>

  

  <div class="devsite-article-body clearfix
    ">

    
      
<p></p>

<!-- DO NOT EDIT! Automatically generated file. -->

<div itemscope="" itemtype="http://developers.google.com/ReferenceObject">
<meta itemprop="name" content="TensorFlow Addons Networks : Sequence-to-Sequence NMT with Attention Mechanism">
<meta itemprop="path" content="Guide &amp; Tutorials">
<meta itemprop="property" content="tfa.seq2seq.AttentionWrapper">
<meta itemprop="property" content="tfa.seq2seq.BahdanauAttention">
<meta itemprop="property" content="tfa.seq2seq.BasicDecoder">
<meta itemprop="property" content="tfa.seq2seq.BeamSearchDecoder">
<meta itemprop="property" content="tfa.seq2seq.GreedyEmbeddingSampler">
<meta itemprop="property" content="tfa.seq2seq.LuongAttention">
<meta itemprop="property" content="tfa.seq2seq.tile_batch">
</div>



<div class="devsite-table-wrapper"><table class="tfo-notebook-buttons" align="left">
  <tbody><tr><td>
    <a target="_blank" href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt"><img src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/tf_logo_32px.png">View on TensorFlow.org</a>
  </td>
  <td>
    <a target="_blank" href="https://colab.research.google.com/github/tensorflow/addons/blob/master/docs/tutorials/networks_seq2seq_nmt.ipynb"><img src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/colab_logo_32px.png">Run in Google Colab</a>
  </td>
  <td>
    <a target="_blank" href="https://github.com/tensorflow/addons/blob/master/docs/tutorials/networks_seq2seq_nmt.ipynb"><img src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/GitHub-Mark-32px.png">View source on GitHub</a>
  </td>
      <td>
    <a href="https://storage.googleapis.com/tensorflow_docs/addons/docs/tutorials/networks_seq2seq_nmt.ipynb"><img src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/download_logo_32px.png">Download notebook</a>
  </td>
</tr></tbody></table></div>

<h2 id="overview" data-text="Overview" role="presentation"><span class="devsite-heading" role="heading" aria-level="2">Overview</span><button type="button" class="devsite-heading-link button-flat material-icons" aria-label="Copy link to this section: Overview" data-title="Copy link to this section: Overview" data-id="overview"></button></h2>

<p>This notebook gives a brief introduction into the <strong><em>Sequence to Sequence Model Architecture</em></strong>
In this noteboook you broadly cover four essential topics necessary for Neural Machine Translation:</p>

<ul>
<li><strong>Data cleaning</strong></li>
<li><strong>Data preparation</strong></li>
<li><strong>Neural Translation Model with Attention</strong></li>
<li><strong>Final Translation with <code translate="no" dir="ltr">tf.addons.seq2seq.BasicDecoder</code> and <code translate="no" dir="ltr">tf.addons.seq2seq.BeamSearchDecoder</code></strong> </li>
</ul>

<p>The basic idea behind such a model though, is only the 
encoder-decoder architecture. These networks are usually used for a 
variety of tasks like text-summerization, Machine translation, Image 
Captioning, etc. This tutorial provideas a hands-on understanding of the
 concept, explaining the technical jargons wherever necessary. You focus
 on the task of Neural Machine Translation (NMT) which was the very 
first testbed for seq2seq models.</p>

<h2 id="setup" data-text="Setup" role="presentation"><span class="devsite-heading" role="heading" aria-level="2">Setup</span><button type="button" class="devsite-heading-link button-flat material-icons" aria-label="Copy link to this section: Setup" data-title="Copy link to this section: Setup" data-id="setup"></button></h2>

<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="lang-bsh" translate="no" dir="ltr" is-upgraded=""><code class="devsite-terminal" dir="ltr"><span class="pln">pip install tensorflow</span><span class="pun">-</span><span class="pln">addons</span><span class="pun">==</span><span class="lit">0.11</span><span class="pun">.</span><span class="lit">2</span></code><span class="pln"><br></span></pre></devsite-code>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">import</span><span class="pln"> tensorflow </span><span class="kwd">as</span><span class="pln"> tf<br></span><span class="kwd">import</span><span class="pln"> tensorflow_addons </span><span class="kwd">as</span><span class="pln"> tfa<br><br></span><span class="kwd">import</span><span class="pln"> matplotlib</span><span class="pun">.</span><span class="pln">pyplot </span><span class="kwd">as</span><span class="pln"> plt<br></span><span class="kwd">import</span><span class="pln"> matplotlib</span><span class="pun">.</span><span class="pln">ticker </span><span class="kwd">as</span><span class="pln"> ticker<br></span><span class="kwd">from</span><span class="pln"> sklearn</span><span class="pun">.</span><span class="pln">model_selection </span><span class="kwd">import</span><span class="pln"> train_test_split<br><br></span><span class="kwd">import</span><span class="pln"> unicodedata<br></span><span class="kwd">import</span><span class="pln"> re<br></span><span class="kwd">import</span><span class="pln"> numpy </span><span class="kwd">as</span><span class="pln"> np<br></span><span class="kwd">import</span><span class="pln"> os<br></span><span class="kwd">import</span><span class="pln"> io<br></span><span class="kwd">import</span><span class="pln"> time<br></span></code></pre></devsite-code>
<h2 id="data_cleaning_and_data_preparation" data-text="Data Cleaning and Data Preparation" role="presentation"><span class="devsite-heading" role="heading" aria-level="2">Data Cleaning and Data Preparation</span><button type="button" class="devsite-heading-link button-flat material-icons" aria-label="Copy link to this section: Data Cleaning and Data Preparation" data-title="Copy link to this section: Data Cleaning and Data Preparation" data-id="data_cleaning_and_data_preparation"></button></h2>

<p>You'll use a language dataset provided by <a href="http://www.manythings.org/anki/">http://www.manythings.org/anki/</a> This dataset contains language translation pairs in the format:</p>

<hr>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="pln">&nbsp; </span><span class="typ">May</span><span class="pln"> I borrow </span><span class="kwd">this</span><span class="pln"> book</span><span class="pun">?</span><span class="pln"> &nbsp; &nbsp;</span><span class="pun">¿</span><span class="typ">Puedo</span><span class="pln"> tomar prestado este libro</span><span class="pun">?</span><span class="pln"><br></span></code></pre></devsite-code>
<hr>

<p>There are a variety of languages available, but you'll use the 
English-Spanish dataset. After downloading the dataset, here are the 
steps you'll take to prepare the data:</p>

<ol>
<li>Add a start and end token to each sentence.</li>
<li>Clean the sentences by removing special characters.</li>
<li>Create a Vocabulary with word index (mapping from word → id) and reverse word index (mapping from id → word).</li>
<li>Pad each sentence to a maximum length. (Why? you need to fix the maximum length for the inputs to recurrent encoders)</li>
</ol>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">def</span><span class="pln"> download_nmt</span><span class="pun">():</span><span class="pln"><br>&nbsp; &nbsp; path_to_zip </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">keras</span><span class="pun">.</span><span class="pln">utils</span><span class="pun">.</span><span class="pln">get_file</span><span class="pun">(</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="str">'spa-eng.zip'</span><span class="pun">,</span><span class="pln"> origin</span><span class="pun">=</span><span class="str">'http://storage.googleapis.com/download.tensorflow.org/data/spa-eng.zip'</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; extract</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; &nbsp; path_to_file </span><span class="pun">=</span><span class="pln"> os</span><span class="pun">.</span><span class="pln">path</span><span class="pun">.</span><span class="pln">dirname</span><span class="pun">(</span><span class="pln">path_to_zip</span><span class="pun">)+</span><span class="str">"/spa-eng/spa.txt"</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> path_to_file<br></span></code></pre></devsite-code>
<h3 id="define_a_nmtdataset_class_with_necessary_functions_to_follow_step_1_to_step_4" data-text="Define a NMTDataset class with necessary functions to follow Step 1 to Step 4." role="presentation"><span class="devsite-heading" role="heading" aria-level="3">Define a NMTDataset class with necessary functions to follow Step 1 to Step 4.<wbr></span><button type="button" class="devsite-heading-link button-flat material-icons" aria-label="Copy link to this section: Define a NMTDataset class with necessary functions to follow Step 1 to Step 4." data-title="Copy link to this section: Define a NMTDataset class with necessary functions to follow Step 1 to Step 4." data-id="define_a_nmtdataset_class_with_necessary_functions_to_follow_step_1_to_step_4"></button></h3>

<p>The <code translate="no" dir="ltr">call()</code> will return:</p>

<ol>
<li><code translate="no" dir="ltr">train_dataset</code>  and <code translate="no" dir="ltr">val_dataset</code> : <code translate="no" dir="ltr">tf.data.Dataset</code> objects</li>
<li><code translate="no" dir="ltr">inp_lang_tokenizer</code> and <code translate="no" dir="ltr">targ_lang_tokenizer</code> : <code translate="no" dir="ltr">tf.keras.preprocessing.text.Tokenizer</code> objects </li>
</ol>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">class</span><span class="pln"> </span><span class="typ">NMTDataset</span><span class="pun">:</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">def</span><span class="pln"> __init__</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> problem_type</span><span class="pun">=</span><span class="str">'en-spa'</span><span class="pun">):</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">problem_type </span><span class="pun">=</span><span class="pln"> </span><span class="str">'en-spa'</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">inp_lang_tokenizer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">None</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">targ_lang_tokenizer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">None</span><span class="pln"><br><br><br>&nbsp; &nbsp; </span><span class="kwd">def</span><span class="pln"> unicode_to_ascii</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> s</span><span class="pun">):</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="str">''</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="pln">c </span><span class="kwd">for</span><span class="pln"> c </span><span class="kwd">in</span><span class="pln"> unicodedata</span><span class="pun">.</span><span class="pln">normalize</span><span class="pun">(</span><span class="str">'NFD'</span><span class="pun">,</span><span class="pln"> s</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> unicodedata</span><span class="pun">.</span><span class="pln">category</span><span class="pun">(</span><span class="pln">c</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="str">'Mn'</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span class="com">## Step 1 and Step 2 </span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">def</span><span class="pln"> preprocess_sentence</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> w</span><span class="pun">):</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; w </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">unicode_to_ascii</span><span class="pun">(</span><span class="pln">w</span><span class="pun">.</span><span class="pln">lower</span><span class="pun">().</span><span class="pln">strip</span><span class="pun">())</span><span class="pln"><br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com"># creating a space between a word and the punctuation following it</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com"># eg: "he is a boy." =&gt; "he is a boy ."</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com"># Reference:- https://stackoverflow.com/questions/3645931/python-padding-punctuation-with-white-spaces-keeping-punctuation</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; w </span><span class="pun">=</span><span class="pln"> re</span><span class="pun">.</span><span class="kwd">sub</span><span class="pun">(</span><span class="pln">r</span><span class="str">"([?.!,¿])"</span><span class="pun">,</span><span class="pln"> r</span><span class="str">" \1 "</span><span class="pun">,</span><span class="pln"> w</span><span class="pun">)</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; w </span><span class="pun">=</span><span class="pln"> re</span><span class="pun">.</span><span class="kwd">sub</span><span class="pun">(</span><span class="pln">r</span><span class="str">'[" "]+'</span><span class="pun">,</span><span class="pln"> </span><span class="str">" "</span><span class="pun">,</span><span class="pln"> w</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com"># replacing everything with space except (a-z, A-Z, ".", "?", "!", ",")</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; w </span><span class="pun">=</span><span class="pln"> re</span><span class="pun">.</span><span class="kwd">sub</span><span class="pun">(</span><span class="pln">r</span><span class="str">"[^a-zA-Z?.!,¿]+"</span><span class="pun">,</span><span class="pln"> </span><span class="str">" "</span><span class="pun">,</span><span class="pln"> w</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; &nbsp; &nbsp; &nbsp; w </span><span class="pun">=</span><span class="pln"> w</span><span class="pun">.</span><span class="pln">strip</span><span class="pun">()</span><span class="pln"><br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com"># adding a start and an end token to the sentence</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com"># so that the model know when to start and stop predicting.</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; w </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;start&gt; '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> w </span><span class="pun">+</span><span class="pln"> </span><span class="str">' &lt;end&gt;'</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> w<br><br>&nbsp; &nbsp; </span><span class="kwd">def</span><span class="pln"> create_dataset</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> path</span><span class="pun">,</span><span class="pln"> num_examples</span><span class="pun">):</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com"># path : path to spa-eng.txt file</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com"># num_examples : Limit the total number of training example for faster training (set num_examples = len(lines) to use full data)</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; lines </span><span class="pun">=</span><span class="pln"> io</span><span class="pun">.</span><span class="pln">open</span><span class="pun">(</span><span class="pln">path</span><span class="pun">,</span><span class="pln"> encoding</span><span class="pun">=</span><span class="str">'UTF-8'</span><span class="pun">).</span><span class="pln">read</span><span class="pun">().</span><span class="pln">strip</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">'\n'</span><span class="pun">)</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; word_pairs </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[[</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">preprocess_sentence</span><span class="pun">(</span><span class="pln">w</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> w </span><span class="kwd">in</span><span class="pln"> l</span><span class="pun">.</span><span class="pln">split</span><span class="pun">(</span><span class="str">'\t'</span><span class="pun">)]</span><span class="pln"> &nbsp;</span><span class="kwd">for</span><span class="pln"> l </span><span class="kwd">in</span><span class="pln"> lines</span><span class="pun">[:</span><span class="pln">num_examples</span><span class="pun">]]</span><span class="pln"><br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> zip</span><span class="pun">(*</span><span class="pln">word_pairs</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span class="com"># Step 3 and Step 4</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">def</span><span class="pln"> tokenize</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> lang</span><span class="pun">):</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com"># lang = list of sentences in a language</span><span class="pln"><br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com"># print(len(lang), "example sentence: {}".format(lang[0]))</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; lang_tokenizer </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">keras</span><span class="pun">.</span><span class="pln">preprocessing</span><span class="pun">.</span><span class="pln">text</span><span class="pun">.</span><span class="typ">Tokenizer</span><span class="pun">(</span><span class="pln">filters</span><span class="pun">=</span><span class="str">''</span><span class="pun">,</span><span class="pln"> oov_token</span><span class="pun">=</span><span class="str">'&lt;OOV&gt;'</span><span class="pun">)</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; lang_tokenizer</span><span class="pun">.</span><span class="pln">fit_on_texts</span><span class="pun">(</span><span class="pln">lang</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">## tf.keras.preprocessing.text.Tokenizer.texts_to_sequences converts string (w1, w2, w3, ......, wn) </span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">## to a list of correspoding integer ids of words (id_w1, id_w2, id_w3, ...., id_wn)</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; tensor </span><span class="pun">=</span><span class="pln"> lang_tokenizer</span><span class="pun">.</span><span class="pln">texts_to_sequences</span><span class="pun">(</span><span class="pln">lang</span><span class="pun">)</span><span class="pln"> <br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">## tf.keras.preprocessing.sequence.pad_sequences takes argument a list of integer id sequences </span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">## and pads the sequences to match the longest sequences in the given input</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; tensor </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">keras</span><span class="pun">.</span><span class="pln">preprocessing</span><span class="pun">.</span><span class="pln">sequence</span><span class="pun">.</span><span class="pln">pad_sequences</span><span class="pun">(</span><span class="pln">tensor</span><span class="pun">,</span><span class="pln"> padding</span><span class="pun">=</span><span class="str">'post'</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> tensor</span><span class="pun">,</span><span class="pln"> lang_tokenizer<br><br>&nbsp; &nbsp; </span><span class="kwd">def</span><span class="pln"> load_dataset</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> path</span><span class="pun">,</span><span class="pln"> num_examples</span><span class="pun">=</span><span class="kwd">None</span><span class="pun">):</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com"># creating cleaned input, output pairs</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; targ_lang</span><span class="pun">,</span><span class="pln"> inp_lang </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">create_dataset</span><span class="pun">(</span><span class="pln">path</span><span class="pun">,</span><span class="pln"> num_examples</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; &nbsp; &nbsp; &nbsp; input_tensor</span><span class="pun">,</span><span class="pln"> inp_lang_tokenizer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">tokenize</span><span class="pun">(</span><span class="pln">inp_lang</span><span class="pun">)</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; target_tensor</span><span class="pun">,</span><span class="pln"> targ_lang_tokenizer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">tokenize</span><span class="pun">(</span><span class="pln">targ_lang</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> input_tensor</span><span class="pun">,</span><span class="pln"> target_tensor</span><span class="pun">,</span><span class="pln"> inp_lang_tokenizer</span><span class="pun">,</span><span class="pln"> targ_lang_tokenizer<br><br>&nbsp; &nbsp; </span><span class="kwd">def</span><span class="pln"> call</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> num_examples</span><span class="pun">,</span><span class="pln"> BUFFER_SIZE</span><span class="pun">,</span><span class="pln"> BATCH_SIZE</span><span class="pun">):</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; file_path </span><span class="pun">=</span><span class="pln"> download_nmt</span><span class="pun">()</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; input_tensor</span><span class="pun">,</span><span class="pln"> target_tensor</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">inp_lang_tokenizer</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">targ_lang_tokenizer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">load_dataset</span><span class="pun">(</span><span class="pln">file_path</span><span class="pun">,</span><span class="pln"> num_examples</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; &nbsp; &nbsp; &nbsp; input_tensor_train</span><span class="pun">,</span><span class="pln"> input_tensor_val</span><span class="pun">,</span><span class="pln"> target_tensor_train</span><span class="pun">,</span><span class="pln"> target_tensor_val </span><span class="pun">=</span><span class="pln"> train_test_split</span><span class="pun">(</span><span class="pln">input_tensor</span><span class="pun">,</span><span class="pln"> target_tensor</span><span class="pun">,</span><span class="pln"> test_size</span><span class="pun">=</span><span class="lit">0.2</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; &nbsp; &nbsp; &nbsp; train_dataset </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">data</span><span class="pun">.</span><span class="typ">Dataset</span><span class="pun">.</span><span class="pln">from_tensor_slices</span><span class="pun">((</span><span class="pln">input_tensor_train</span><span class="pun">,</span><span class="pln"> target_tensor_train</span><span class="pun">))</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; train_dataset </span><span class="pun">=</span><span class="pln"> train_dataset</span><span class="pun">.</span><span class="pln">shuffle</span><span class="pun">(</span><span class="pln">BUFFER_SIZE</span><span class="pun">).</span><span class="pln">batch</span><span class="pun">(</span><span class="pln">BATCH_SIZE</span><span class="pun">,</span><span class="pln"> drop_remainder</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; &nbsp; &nbsp; &nbsp; val_dataset </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">data</span><span class="pun">.</span><span class="typ">Dataset</span><span class="pun">.</span><span class="pln">from_tensor_slices</span><span class="pun">((</span><span class="pln">input_tensor_val</span><span class="pun">,</span><span class="pln"> target_tensor_val</span><span class="pun">))</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; val_dataset </span><span class="pun">=</span><span class="pln"> val_dataset</span><span class="pun">.</span><span class="pln">batch</span><span class="pun">(</span><span class="pln">BATCH_SIZE</span><span class="pun">,</span><span class="pln"> drop_remainder</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> train_dataset</span><span class="pun">,</span><span class="pln"> val_dataset</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">inp_lang_tokenizer</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">targ_lang_tokenizer<br></span></code></pre></devsite-code><devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="pln">BUFFER_SIZE </span><span class="pun">=</span><span class="pln"> </span><span class="lit">32000</span><span class="pln"><br>BATCH_SIZE </span><span class="pun">=</span><span class="pln"> </span><span class="lit">64</span><span class="pln"><br></span><span class="com"># Let's limit the #training examples for faster training</span><span class="pln"><br>num_examples </span><span class="pun">=</span><span class="pln"> </span><span class="lit">30000</span><span class="pln"><br><br>dataset_creator </span><span class="pun">=</span><span class="pln"> </span><span class="typ">NMTDataset</span><span class="pun">(</span><span class="str">'en-spa'</span><span class="pun">)</span><span class="pln"><br>train_dataset</span><span class="pun">,</span><span class="pln"> val_dataset</span><span class="pun">,</span><span class="pln"> inp_lang</span><span class="pun">,</span><span class="pln"> targ_lang </span><span class="pun">=</span><span class="pln"> dataset_creator</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="pln">num_examples</span><span class="pun">,</span><span class="pln"> BUFFER_SIZE</span><span class="pun">,</span><span class="pln"> BATCH_SIZE</span><span class="pun">)</span><span class="pln"><br></span></code></pre></devsite-code><devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="pln">example_input_batch</span><span class="pun">,</span><span class="pln"> example_target_batch </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">next</span><span class="pun">(</span><span class="pln">iter</span><span class="pun">(</span><span class="pln">train_dataset</span><span class="pun">))</span><span class="pln"><br>example_input_batch</span><span class="pun">.</span><span class="pln">shape</span><span class="pun">,</span><span class="pln"> example_target_batch</span><span class="pun">.</span><span class="pln">shape<br></span></code></pre></devsite-code>
<devsite-code no-copy="" data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button></div><pre class="tfo-notebook-code-cell-output" translate="no" dir="ltr" is-upgraded="">(TensorShape([64, 16]), TensorShape([64, 11]))
</pre></devsite-code>

<h3 id="some_important_parameters" data-text="Some important parameters" role="presentation"><span class="devsite-heading" role="heading" aria-level="3">Some important parameters</span><button type="button" class="devsite-heading-link button-flat material-icons" aria-label="Copy link to this section: Some important parameters" data-title="Copy link to this section: Some important parameters" data-id="some_important_parameters"></button></h3>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="pln">vocab_inp_size </span><span class="pun">=</span><span class="pln"> len</span><span class="pun">(</span><span class="pln">inp_lang</span><span class="pun">.</span><span class="pln">word_index</span><span class="pun">)+</span><span class="lit">1</span><span class="pln"><br>vocab_tar_size </span><span class="pun">=</span><span class="pln"> len</span><span class="pun">(</span><span class="pln">targ_lang</span><span class="pun">.</span><span class="pln">word_index</span><span class="pun">)+</span><span class="lit">1</span><span class="pln"><br>max_length_input </span><span class="pun">=</span><span class="pln"> example_input_batch</span><span class="pun">.</span><span class="pln">shape</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"><br>max_length_output </span><span class="pun">=</span><span class="pln"> example_target_batch</span><span class="pun">.</span><span class="pln">shape</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"><br><br>embedding_dim </span><span class="pun">=</span><span class="pln"> </span><span class="lit">256</span><span class="pln"><br>units </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1024</span><span class="pln"><br>steps_per_epoch </span><span class="pun">=</span><span class="pln"> num_examples</span><span class="com">//BATCH_SIZE</span><span class="pln"><br></span></code></pre></devsite-code><devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">print</span><span class="pun">(</span><span class="str">"max_length_english, max_length_spanish, vocab_size_english, vocab_size_spanish"</span><span class="pun">)</span><span class="pln"><br>max_length_input</span><span class="pun">,</span><span class="pln"> max_length_output</span><span class="pun">,</span><span class="pln"> vocab_inp_size</span><span class="pun">,</span><span class="pln"> vocab_tar_size<br></span></code></pre></devsite-code>
<devsite-code no-copy="" data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button></div><pre class="tfo-notebook-code-cell-output" translate="no" dir="ltr" is-upgraded="">max_length_spanish, max_length_english, vocab_size_spanish, vocab_size_english
(16, 11, 9415, 4936)
</pre></devsite-code>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="com">##### </span><span class="pln"><br><br></span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Encoder</span><span class="pun">(</span><span class="pln">tf</span><span class="pun">.</span><span class="pln">keras</span><span class="pun">.</span><span class="typ">Model</span><span class="pun">):</span><span class="pln"><br>&nbsp; </span><span class="kwd">def</span><span class="pln"> __init__</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> vocab_size</span><span class="pun">,</span><span class="pln"> embedding_dim</span><span class="pun">,</span><span class="pln"> enc_units</span><span class="pun">,</span><span class="pln"> batch_sz</span><span class="pun">):</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">super</span><span class="pun">(</span><span class="typ">Encoder</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">).</span><span class="pln">__init__</span><span class="pun">()</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">batch_sz </span><span class="pun">=</span><span class="pln"> batch_sz<br>&nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">enc_units </span><span class="pun">=</span><span class="pln"> enc_units<br>&nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">embedding </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">keras</span><span class="pun">.</span><span class="pln">layers</span><span class="pun">.</span><span class="typ">Embedding</span><span class="pun">(</span><span class="pln">vocab_size</span><span class="pun">,</span><span class="pln"> embedding_dim</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span class="com">##-------- LSTM layer in Encoder ------- ##</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">lstm_layer </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">keras</span><span class="pun">.</span><span class="pln">layers</span><span class="pun">.</span><span class="pln">LSTM</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">enc_units</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return_sequences</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return_state</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;recurrent_initializer</span><span class="pun">=</span><span class="str">'glorot_uniform'</span><span class="pun">)</span><span class="pln"><br><br><br><br>&nbsp; </span><span class="kwd">def</span><span class="pln"> call</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> hidden</span><span class="pun">):</span><span class="pln"><br>&nbsp; &nbsp; x </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">embedding</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"><br>&nbsp; &nbsp; output</span><span class="pun">,</span><span class="pln"> h</span><span class="pun">,</span><span class="pln"> c </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">lstm_layer</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> initial_state </span><span class="pun">=</span><span class="pln"> hidden</span><span class="pun">)</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> output</span><span class="pun">,</span><span class="pln"> h</span><span class="pun">,</span><span class="pln"> c<br><br>&nbsp; </span><span class="kwd">def</span><span class="pln"> initialize_hidden_state</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">):</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">[</span><span class="pln">tf</span><span class="pun">.</span><span class="pln">zeros</span><span class="pun">((</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">batch_sz</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">enc_units</span><span class="pun">)),</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">zeros</span><span class="pun">((</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">batch_sz</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">enc_units</span><span class="pun">))]</span><span class="pln"><br></span></code></pre></devsite-code><devsite-code data-copy-event-label=""><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="com">## Test Encoder Stack</span><span class="pln"><br><br>encoder </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Encoder</span><span class="pun">(</span><span class="pln">vocab_inp_size</span><span class="pun">,</span><span class="pln"> embedding_dim</span><span class="pun">,</span><span class="pln"> units</span><span class="pun">,</span><span class="pln"> BATCH_SIZE</span><span class="pun">)</span><span class="pln"><br><br><br></span><span class="com"># sample input</span><span class="pln"><br>sample_hidden </span><span class="pun">=</span><span class="pln"> encoder</span><span class="pun">.</span><span class="pln">initialize_hidden_state</span><span class="pun">()</span><span class="pln"><br>sample_output</span><span class="pun">,</span><span class="pln"> sample_h</span><span class="pun">,</span><span class="pln"> sample_c </span><span class="pun">=</span><span class="pln"> encoder</span><span class="pun">(</span><span class="pln">example_input_batch</span><span class="pun">,</span><span class="pln"> sample_hidden</span><span class="pun">)</span><span class="pln"><br></span><span class="kwd">print</span><span class="pln"> </span><span class="pun">(</span><span class="str">'Encoder output shape: (batch size, sequence length, units) {}'</span><span class="pun">.</span><span class="pln">format</span><span class="pun">(</span><span class="pln">sample_output</span><span class="pun">.</span><span class="pln">shape</span><span class="pun">))</span><span class="pln"><br></span><span class="kwd">print</span><span class="pln"> </span><span class="pun">(</span><span class="str">'Encoder h vecotr shape: (batch size, units) {}'</span><span class="pun">.</span><span class="pln">format</span><span class="pun">(</span><span class="pln">sample_h</span><span class="pun">.</span><span class="pln">shape</span><span class="pun">))</span><span class="pln"><br></span><span class="kwd">print</span><span class="pln"> </span><span class="pun">(</span><span class="str">'Encoder c vector shape: (batch size, units) {}'</span><span class="pun">.</span><span class="pln">format</span><span class="pun">(</span><span class="pln">sample_c</span><span class="pun">.</span><span class="pln">shape</span><span class="pun">))</span><span class="pln"><br></span></code></pre></devsite-code>
<devsite-code no-copy="" data-copy-event-label=""><pre class="tfo-notebook-code-cell-output" translate="no" dir="ltr" is-upgraded="">Encoder output shape: (batch size, sequence length, units) (64, 16, 1024)
Encoder h vecotr shape: (batch size, units) (64, 1024)
Encoder c vector shape: (batch size, units) (64, 1024)
</pre></devsite-code>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Decoder</span><span class="pun">(</span><span class="pln">tf</span><span class="pun">.</span><span class="pln">keras</span><span class="pun">.</span><span class="typ">Model</span><span class="pun">):</span><span class="pln"><br>&nbsp; </span><span class="kwd">def</span><span class="pln"> __init__</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> vocab_size</span><span class="pun">,</span><span class="pln"> embedding_dim</span><span class="pun">,</span><span class="pln"> dec_units</span><span class="pun">,</span><span class="pln"> batch_sz</span><span class="pun">,</span><span class="pln"> attention_type</span><span class="pun">=</span><span class="str">'luong'</span><span class="pun">):</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">super</span><span class="pun">(</span><span class="typ">Decoder</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">).</span><span class="pln">__init__</span><span class="pun">()</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">batch_sz </span><span class="pun">=</span><span class="pln"> batch_sz<br>&nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">dec_units </span><span class="pun">=</span><span class="pln"> dec_units<br>&nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">attention_type </span><span class="pun">=</span><span class="pln"> attention_type<br><br>&nbsp; &nbsp; </span><span class="com"># Embedding Layer</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">embedding </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">keras</span><span class="pun">.</span><span class="pln">layers</span><span class="pun">.</span><span class="typ">Embedding</span><span class="pun">(</span><span class="pln">vocab_size</span><span class="pun">,</span><span class="pln"> embedding_dim</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span class="com">#Final Dense layer on which softmax will be applied</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">fc </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">keras</span><span class="pun">.</span><span class="pln">layers</span><span class="pun">.</span><span class="typ">Dense</span><span class="pun">(</span><span class="pln">vocab_size</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span class="com"># Define the fundamental cell for decoder recurrent structure</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">decoder_rnn_cell </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">keras</span><span class="pun">.</span><span class="pln">layers</span><span class="pun">.</span><span class="typ">LSTMCell</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">dec_units</span><span class="pun">)</span><span class="pln"><br><br><br><br>&nbsp; &nbsp; </span><span class="com"># Sampler</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">sampler </span><span class="pun">=</span><span class="pln"> tfa</span><span class="pun">.</span><span class="pln">seq2seq</span><span class="pun">.</span><span class="pln">sampler</span><span class="pun">.</span><span class="typ">TrainingSampler</span><span class="pun">()</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span class="com"># Create attention mechanism with memory = None</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">attention_mechanism </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">build_attention_mechanism</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">dec_units</span><span class="pun">,</span><span class="pln"> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">None</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">batch_sz</span><span class="pun">*[</span><span class="pln">max_length_input</span><span class="pun">],</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">attention_type</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span class="com"># Wrap attention mechanism with the fundamental rnn cell of decoder</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">rnn_cell </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">build_rnn_cell</span><span class="pun">(</span><span class="pln">batch_sz</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span class="com"># Define the decoder with respect to fundamental rnn cell</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">decoder </span><span class="pun">=</span><span class="pln"> tfa</span><span class="pun">.</span><span class="pln">seq2seq</span><span class="pun">.</span><span class="typ">BasicDecoder</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">rnn_cell</span><span class="pun">,</span><span class="pln"> sampler</span><span class="pun">=</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">sampler</span><span class="pun">,</span><span class="pln"> output_layer</span><span class="pun">=</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">fc</span><span class="pun">)</span><span class="pln"><br><br><br>&nbsp; </span><span class="kwd">def</span><span class="pln"> build_rnn_cell</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> batch_sz</span><span class="pun">):</span><span class="pln"><br>&nbsp; &nbsp; rnn_cell </span><span class="pun">=</span><span class="pln"> tfa</span><span class="pun">.</span><span class="pln">seq2seq</span><span class="pun">.</span><span class="typ">AttentionWrapper</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">decoder_rnn_cell</span><span class="pun">,</span><span class="pln"> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">attention_mechanism</span><span class="pun">,</span><span class="pln"> attention_layer_size</span><span class="pun">=</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">dec_units</span><span class="pun">)</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> rnn_cell<br><br>&nbsp; </span><span class="kwd">def</span><span class="pln"> build_attention_mechanism</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> dec_units</span><span class="pun">,</span><span class="pln"> memory</span><span class="pun">,</span><span class="pln"> memory_sequence_length</span><span class="pun">,</span><span class="pln"> attention_type</span><span class="pun">=</span><span class="str">'luong'</span><span class="pun">):</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="com"># ------------- #</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="com"># typ: Which sort of attention (Bahdanau, Luong)</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="com"># dec_units: final dimension of attention outputs </span><span class="pln"><br>&nbsp; &nbsp; </span><span class="com"># memory: encoder hidden states of shape (batch_size, max_length_input, enc_units)</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="com"># memory_sequence_length: 1d array of shape (batch_size) with every element set to max_length_input (for masking purpose)</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">attention_type</span><span class="pun">==</span><span class="str">'bahdanau'</span><span class="pun">):</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> tfa</span><span class="pun">.</span><span class="pln">seq2seq</span><span class="pun">.</span><span class="typ">BahdanauAttention</span><span class="pun">(</span><span class="pln">units</span><span class="pun">=</span><span class="pln">dec_units</span><span class="pun">,</span><span class="pln"> memory</span><span class="pun">=</span><span class="pln">memory</span><span class="pun">,</span><span class="pln"> memory_sequence_length</span><span class="pun">=</span><span class="pln">memory_sequence_length</span><span class="pun">)</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">else</span><span class="pun">:</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> tfa</span><span class="pun">.</span><span class="pln">seq2seq</span><span class="pun">.</span><span class="typ">LuongAttention</span><span class="pun">(</span><span class="pln">units</span><span class="pun">=</span><span class="pln">dec_units</span><span class="pun">,</span><span class="pln"> memory</span><span class="pun">=</span><span class="pln">memory</span><span class="pun">,</span><span class="pln"> memory_sequence_length</span><span class="pun">=</span><span class="pln">memory_sequence_length</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; </span><span class="kwd">def</span><span class="pln"> build_initial_state</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> batch_sz</span><span class="pun">,</span><span class="pln"> encoder_state</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Dtype</span><span class="pun">):</span><span class="pln"><br>&nbsp; &nbsp; decoder_initial_state </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">rnn_cell</span><span class="pun">.</span><span class="pln">get_initial_state</span><span class="pun">(</span><span class="pln">batch_size</span><span class="pun">=</span><span class="pln">batch_sz</span><span class="pun">,</span><span class="pln"> dtype</span><span class="pun">=</span><span class="typ">Dtype</span><span class="pun">)</span><span class="pln"><br>&nbsp; &nbsp; decoder_initial_state </span><span class="pun">=</span><span class="pln"> decoder_initial_state</span><span class="pun">.</span><span class="pln">clone</span><span class="pun">(</span><span class="pln">cell_state</span><span class="pun">=</span><span class="pln">encoder_state</span><span class="pun">)</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> decoder_initial_state<br><br><br>&nbsp; </span><span class="kwd">def</span><span class="pln"> call</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> inputs</span><span class="pun">,</span><span class="pln"> initial_state</span><span class="pun">):</span><span class="pln"><br>&nbsp; &nbsp; x </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">embedding</span><span class="pun">(</span><span class="pln">inputs</span><span class="pun">)</span><span class="pln"><br>&nbsp; &nbsp; outputs</span><span class="pun">,</span><span class="pln"> _</span><span class="pun">,</span><span class="pln"> _ </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">decoder</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> initial_state</span><span class="pun">=</span><span class="pln">initial_state</span><span class="pun">,</span><span class="pln"> sequence_length</span><span class="pun">=</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">batch_sz</span><span class="pun">*[</span><span class="pln">max_length_output</span><span class="pun">-</span><span class="lit">1</span><span class="pun">])</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> outputs<br></span></code></pre></devsite-code><devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="com"># Test decoder stack</span><span class="pln"><br><br>decoder </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Decoder</span><span class="pun">(</span><span class="pln">vocab_tar_size</span><span class="pun">,</span><span class="pln"> embedding_dim</span><span class="pun">,</span><span class="pln"> units</span><span class="pun">,</span><span class="pln"> BATCH_SIZE</span><span class="pun">,</span><span class="pln"> </span><span class="str">'luong'</span><span class="pun">)</span><span class="pln"><br>sample_x </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">random</span><span class="pun">.</span><span class="pln">uniform</span><span class="pun">((</span><span class="pln">BATCH_SIZE</span><span class="pun">,</span><span class="pln"> max_length_output</span><span class="pun">))</span><span class="pln"><br>decoder</span><span class="pun">.</span><span class="pln">attention_mechanism</span><span class="pun">.</span><span class="pln">setup_memory</span><span class="pun">(</span><span class="pln">sample_output</span><span class="pun">)</span><span class="pln"><br>initial_state </span><span class="pun">=</span><span class="pln"> decoder</span><span class="pun">.</span><span class="pln">build_initial_state</span><span class="pun">(</span><span class="pln">BATCH_SIZE</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="pln">sample_h</span><span class="pun">,</span><span class="pln"> sample_c</span><span class="pun">],</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">float32</span><span class="pun">)</span><span class="pln"><br><br><br>sample_decoder_outputs </span><span class="pun">=</span><span class="pln"> decoder</span><span class="pun">(</span><span class="pln">sample_x</span><span class="pun">,</span><span class="pln"> initial_state</span><span class="pun">)</span><span class="pln"><br><br></span><span class="kwd">print</span><span class="pun">(</span><span class="str">"Decoder Outputs Shape: "</span><span class="pun">,</span><span class="pln"> sample_decoder_outputs</span><span class="pun">.</span><span class="pln">rnn_output</span><span class="pun">.</span><span class="pln">shape</span><span class="pun">)</span><span class="pln"><br></span></code></pre></devsite-code>
<devsite-code no-copy="" data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button></div><pre class="tfo-notebook-code-cell-output" translate="no" dir="ltr" is-upgraded="">Decoder Outputs Shape:  (64, 10, 4936)
</pre></devsite-code>

<h2 id="define_the_optimizer_and_the_loss_function" data-text="Define the optimizer and the loss function" role="presentation"><span class="devsite-heading" role="heading" aria-level="2">Define the optimizer and the loss function</span><button type="button" class="devsite-heading-link button-flat material-icons" aria-label="Copy link to this section: Define the optimizer and the loss function" data-title="Copy link to this section: Define the optimizer and the loss function" data-id="define_the_optimizer_and_the_loss_function"></button></h2>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="pln">optimizer </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">keras</span><span class="pun">.</span><span class="pln">optimizers</span><span class="pun">.</span><span class="typ">Adam</span><span class="pun">()</span><span class="pln"><br><br><br></span><span class="kwd">def</span><span class="pln"> loss_function</span><span class="pun">(</span><span class="pln">real</span><span class="pun">,</span><span class="pln"> pred</span><span class="pun">):</span><span class="pln"><br>&nbsp; </span><span class="com"># real shape = (BATCH_SIZE, max_length_output)</span><span class="pln"><br>&nbsp; </span><span class="com"># pred shape = (BATCH_SIZE, max_length_output, tar_vocab_size )</span><span class="pln"><br>&nbsp; cross_entropy </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">keras</span><span class="pun">.</span><span class="pln">losses</span><span class="pun">.</span><span class="typ">SparseCategoricalCrossentropy</span><span class="pun">(</span><span class="pln">from_logits</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">,</span><span class="pln"> reduction</span><span class="pun">=</span><span class="str">'none'</span><span class="pun">)</span><span class="pln"><br>&nbsp; loss </span><span class="pun">=</span><span class="pln"> cross_entropy</span><span class="pun">(</span><span class="pln">y_true</span><span class="pun">=</span><span class="pln">real</span><span class="pun">,</span><span class="pln"> y_pred</span><span class="pun">=</span><span class="pln">pred</span><span class="pun">)</span><span class="pln"><br>&nbsp; mask </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">logical_not</span><span class="pun">(</span><span class="pln">tf</span><span class="pun">.</span><span class="pln">math</span><span class="pun">.</span><span class="pln">equal</span><span class="pun">(</span><span class="pln">real</span><span class="pun">,</span><span class="lit">0</span><span class="pun">))</span><span class="pln"> &nbsp; </span><span class="com">#output 0 for y=0 else output 1</span><span class="pln"><br>&nbsp; mask </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">cast</span><span class="pun">(</span><span class="pln">mask</span><span class="pun">,</span><span class="pln"> dtype</span><span class="pun">=</span><span class="pln">loss</span><span class="pun">.</span><span class="pln">dtype</span><span class="pun">)</span><span class="pln"> &nbsp;<br>&nbsp; loss </span><span class="pun">=</span><span class="pln"> mask</span><span class="pun">*</span><span class="pln"> loss<br>&nbsp; loss </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">reduce_mean</span><span class="pun">(</span><span class="pln">loss</span><span class="pun">)</span><span class="pln"><br>&nbsp; </span><span class="kwd">return</span><span class="pln"> loss<br></span></code></pre></devsite-code>
<h2 id="checkpoints_object-based_saving" data-text="Checkpoints (Object-based saving)" role="presentation"><span class="devsite-heading" role="heading" aria-level="2">Checkpoints (Object-based saving)</span><button type="button" class="devsite-heading-link button-flat material-icons" aria-label="Copy link to this section: Checkpoints (Object-based saving)" data-title="Copy link to this section: Checkpoints (Object-based saving)" data-id="checkpoints_object-based_saving"></button></h2>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="pln">checkpoint_dir </span><span class="pun">=</span><span class="pln"> </span><span class="str">'./training_checkpoints'</span><span class="pln"><br>checkpoint_prefix </span><span class="pun">=</span><span class="pln"> os</span><span class="pun">.</span><span class="pln">path</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="pln">checkpoint_dir</span><span class="pun">,</span><span class="pln"> </span><span class="str">"ckpt"</span><span class="pun">)</span><span class="pln"><br>checkpoint </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">train</span><span class="pun">.</span><span class="typ">Checkpoint</span><span class="pun">(</span><span class="pln">optimizer</span><span class="pun">=</span><span class="pln">optimizer</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;encoder</span><span class="pun">=</span><span class="pln">encoder</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;decoder</span><span class="pun">=</span><span class="pln">decoder</span><span class="pun">)</span><span class="pln"><br></span></code></pre></devsite-code>
<h2 id="one_train_step_operations" data-text="One train_step operations" role="presentation"><span class="devsite-heading" role="heading" aria-level="2">One train_<wbr>step operations</span><button type="button" class="devsite-heading-link button-flat material-icons" aria-label="Copy link to this section: One train_step operations" data-title="Copy link to this section: One train_step operations" data-id="one_train_step_operations"></button></h2>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="lit">@tf</span><span class="pun">.</span><span class="kwd">function</span><span class="pln"><br></span><span class="kwd">def</span><span class="pln"> train_step</span><span class="pun">(</span><span class="pln">inp</span><span class="pun">,</span><span class="pln"> targ</span><span class="pun">,</span><span class="pln"> enc_hidden</span><span class="pun">):</span><span class="pln"><br>&nbsp; loss </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln"><br><br>&nbsp; </span><span class="kwd">with</span><span class="pln"> tf</span><span class="pun">.</span><span class="typ">GradientTape</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> tape</span><span class="pun">:</span><span class="pln"><br>&nbsp; &nbsp; enc_output</span><span class="pun">,</span><span class="pln"> enc_h</span><span class="pun">,</span><span class="pln"> enc_c </span><span class="pun">=</span><span class="pln"> encoder</span><span class="pun">(</span><span class="pln">inp</span><span class="pun">,</span><span class="pln"> enc_hidden</span><span class="pun">)</span><span class="pln"><br><br><br>&nbsp; &nbsp; dec_input </span><span class="pun">=</span><span class="pln"> targ</span><span class="pun">[</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="pun">,</span><span class="pln"> </span><span class="pun">:-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">]</span><span class="pln"> </span><span class="com"># Ignore &lt;end&gt; token</span><span class="pln"><br>&nbsp; &nbsp; real </span><span class="pun">=</span><span class="pln"> targ</span><span class="pun">[</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">:</span><span class="pln"> </span><span class="pun">]</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com"># ignore &lt;start&gt; token</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span class="com"># Set the AttentionMechanism object with encoder_outputs</span><span class="pln"><br>&nbsp; &nbsp; decoder</span><span class="pun">.</span><span class="pln">attention_mechanism</span><span class="pun">.</span><span class="pln">setup_memory</span><span class="pun">(</span><span class="pln">enc_output</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span class="com"># Create AttentionWrapperState as initial_state for decoder</span><span class="pln"><br>&nbsp; &nbsp; decoder_initial_state </span><span class="pun">=</span><span class="pln"> decoder</span><span class="pun">.</span><span class="pln">build_initial_state</span><span class="pun">(</span><span class="pln">BATCH_SIZE</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="pln">enc_h</span><span class="pun">,</span><span class="pln"> enc_c</span><span class="pun">],</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">float32</span><span class="pun">)</span><span class="pln"><br>&nbsp; &nbsp; pred </span><span class="pun">=</span><span class="pln"> decoder</span><span class="pun">(</span><span class="pln">dec_input</span><span class="pun">,</span><span class="pln"> decoder_initial_state</span><span class="pun">)</span><span class="pln"><br>&nbsp; &nbsp; logits </span><span class="pun">=</span><span class="pln"> pred</span><span class="pun">.</span><span class="pln">rnn_output<br>&nbsp; &nbsp; loss </span><span class="pun">=</span><span class="pln"> loss_function</span><span class="pun">(</span><span class="pln">real</span><span class="pun">,</span><span class="pln"> logits</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; variables </span><span class="pun">=</span><span class="pln"> encoder</span><span class="pun">.</span><span class="pln">trainable_variables </span><span class="pun">+</span><span class="pln"> decoder</span><span class="pun">.</span><span class="pln">trainable_variables<br>&nbsp; gradients </span><span class="pun">=</span><span class="pln"> tape</span><span class="pun">.</span><span class="pln">gradient</span><span class="pun">(</span><span class="pln">loss</span><span class="pun">,</span><span class="pln"> variables</span><span class="pun">)</span><span class="pln"><br>&nbsp; optimizer</span><span class="pun">.</span><span class="pln">apply_gradients</span><span class="pun">(</span><span class="pln">zip</span><span class="pun">(</span><span class="pln">gradients</span><span class="pun">,</span><span class="pln"> variables</span><span class="pun">))</span><span class="pln"><br><br>&nbsp; </span><span class="kwd">return</span><span class="pln"> loss<br></span></code></pre></devsite-code>
<h2 id="train_the_model" data-text="Train the model" role="presentation"><span class="devsite-heading" role="heading" aria-level="2">Train the model</span><button type="button" class="devsite-heading-link button-flat material-icons" aria-label="Copy link to this section: Train the model" data-title="Copy link to this section: Train the model" data-id="train_the_model"></button></h2>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="pln">EPOCHS </span><span class="pun">=</span><span class="pln"> </span><span class="lit">10</span><span class="pln"><br><br></span><span class="kwd">for</span><span class="pln"> epoch </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">EPOCHS</span><span class="pun">):</span><span class="pln"><br>&nbsp; start </span><span class="pun">=</span><span class="pln"> time</span><span class="pun">.</span><span class="pln">time</span><span class="pun">()</span><span class="pln"><br><br>&nbsp; enc_hidden </span><span class="pun">=</span><span class="pln"> encoder</span><span class="pun">.</span><span class="pln">initialize_hidden_state</span><span class="pun">()</span><span class="pln"><br>&nbsp; total_loss </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln"><br>&nbsp; </span><span class="com"># print(enc_hidden[0].shape, enc_hidden[1].shape)</span><span class="pln"><br><br>&nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">batch</span><span class="pun">,</span><span class="pln"> </span><span class="pun">(</span><span class="pln">inp</span><span class="pun">,</span><span class="pln"> targ</span><span class="pun">))</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> enumerate</span><span class="pun">(</span><span class="pln">train_dataset</span><span class="pun">.</span><span class="pln">take</span><span class="pun">(</span><span class="pln">steps_per_epoch</span><span class="pun">)):</span><span class="pln"><br>&nbsp; &nbsp; batch_loss </span><span class="pun">=</span><span class="pln"> train_step</span><span class="pun">(</span><span class="pln">inp</span><span class="pun">,</span><span class="pln"> targ</span><span class="pun">,</span><span class="pln"> enc_hidden</span><span class="pun">)</span><span class="pln"><br>&nbsp; &nbsp; total_loss </span><span class="pun">+=</span><span class="pln"> batch_loss<br><br>&nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> batch </span><span class="pun">%</span><span class="pln"> </span><span class="lit">100</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">:</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="kwd">print</span><span class="pun">(</span><span class="str">'Epoch {} Batch {} Loss {:.4f}'</span><span class="pun">.</span><span class="pln">format</span><span class="pun">(</span><span class="pln">epoch </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;batch</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;batch_loss</span><span class="pun">.</span><span class="pln">numpy</span><span class="pun">()))</span><span class="pln"><br>&nbsp; </span><span class="com"># saving (checkpoint) the model every 2 epochs</span><span class="pln"><br>&nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">epoch </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">:</span><span class="pln"><br>&nbsp; &nbsp; checkpoint</span><span class="pun">.</span><span class="pln">save</span><span class="pun">(</span><span class="pln">file_prefix </span><span class="pun">=</span><span class="pln"> checkpoint_prefix</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; </span><span class="kwd">print</span><span class="pun">(</span><span class="str">'Epoch {} Loss {:.4f}'</span><span class="pun">.</span><span class="pln">format</span><span class="pun">(</span><span class="pln">epoch </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; total_loss </span><span class="pun">/</span><span class="pln"> steps_per_epoch</span><span class="pun">))</span><span class="pln"><br>&nbsp; </span><span class="kwd">print</span><span class="pun">(</span><span class="str">'Time taken for 1 epoch {} sec\n'</span><span class="pun">.</span><span class="pln">format</span><span class="pun">(</span><span class="pln">time</span><span class="pun">.</span><span class="pln">time</span><span class="pun">()</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> start</span><span class="pun">))</span><span class="pln"><br></span></code></pre></devsite-code>
<devsite-code no-copy="" data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button></div><pre class="tfo-notebook-code-cell-output" translate="no" dir="ltr" is-upgraded="">Epoch 1 Batch 0 Loss 5.1692
Epoch 1 Batch 100 Loss 2.2288
Epoch 1 Batch 200 Loss 1.9930
Epoch 1 Batch 300 Loss 1.7783
Epoch 1 Loss 1.6975
Time taken for 1 epoch 37.26002788543701 sec

Epoch 2 Batch 0 Loss 1.6408
Epoch 2 Batch 100 Loss 1.5767
Epoch 2 Batch 200 Loss 1.4054
Epoch 2 Batch 300 Loss 1.3755
Epoch 2 Loss 1.1412
Time taken for 1 epoch 30.0094051361084 sec

Epoch 3 Batch 0 Loss 1.0296
Epoch 3 Batch 100 Loss 1.0306
Epoch 3 Batch 200 Loss 1.0675
Epoch 3 Batch 300 Loss 0.9574
Epoch 3 Loss 0.8037
Time taken for 1 epoch 28.983767986297607 sec

Epoch 4 Batch 0 Loss 0.5923
Epoch 4 Batch 100 Loss 0.7533
Epoch 4 Batch 200 Loss 0.7397
Epoch 4 Batch 300 Loss 0.6779
Epoch 4 Loss 0.5419
Time taken for 1 epoch 29.649972200393677 sec

Epoch 5 Batch 0 Loss 0.4320
Epoch 5 Batch 100 Loss 0.4349
Epoch 5 Batch 200 Loss 0.4686
Epoch 5 Batch 300 Loss 0.4748
Epoch 5 Loss 0.3827
Time taken for 1 epoch 29.06334638595581 sec

Epoch 6 Batch 0 Loss 0.3422
Epoch 6 Batch 100 Loss 0.3052
Epoch 6 Batch 200 Loss 0.3288
Epoch 6 Batch 300 Loss 0.3216
Epoch 6 Loss 0.2814
Time taken for 1 epoch 29.57170796394348 sec

Epoch 7 Batch 0 Loss 0.2129
Epoch 7 Batch 100 Loss 0.2382
Epoch 7 Batch 200 Loss 0.2406
Epoch 7 Batch 300 Loss 0.2792
Epoch 7 Loss 0.2162
Time taken for 1 epoch 28.95500087738037 sec

Epoch 8 Batch 0 Loss 0.2073
Epoch 8 Batch 100 Loss 0.2095
Epoch 8 Batch 200 Loss 0.1962
Epoch 8 Batch 300 Loss 0.1879
Epoch 8 Loss 0.1794
Time taken for 1 epoch 29.70877432823181 sec

Epoch 9 Batch 0 Loss 0.1517
Epoch 9 Batch 100 Loss 0.2231
Epoch 9 Batch 200 Loss 0.2203
Epoch 9 Batch 300 Loss 0.2282
Epoch 9 Loss 0.1496
Time taken for 1 epoch 29.20821261405945 sec

Epoch 10 Batch 0 Loss 0.1204
Epoch 10 Batch 100 Loss 0.1370
Epoch 10 Batch 200 Loss 0.1778
Epoch 10 Batch 300 Loss 0.2069
Epoch 10 Loss 0.1316
Time taken for 1 epoch 29.576894283294678 sec
</pre></devsite-code>

<h2 id="use_tf-addons_basicdecoder_for_decoding" data-text="Use tf-addons BasicDecoder for decoding" role="presentation"><span class="devsite-heading" role="heading" aria-level="2">Use tf-addons BasicDecoder for decoding</span><button type="button" class="devsite-heading-link button-flat material-icons" aria-label="Copy link to this section: Use tf-addons BasicDecoder for decoding" data-title="Copy link to this section: Use tf-addons BasicDecoder for decoding" data-id="use_tf-addons_basicdecoder_for_decoding"></button></h2>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">def</span><span class="pln"> evaluate_sentence</span><span class="pun">(</span><span class="pln">sentence</span><span class="pun">):</span><span class="pln"><br>&nbsp; sentence </span><span class="pun">=</span><span class="pln"> dataset_creator</span><span class="pun">.</span><span class="pln">preprocess_sentence</span><span class="pun">(</span><span class="pln">sentence</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; inputs </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">inp_lang</span><span class="pun">.</span><span class="pln">word_index</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> sentence</span><span class="pun">.</span><span class="pln">split</span><span class="pun">(</span><span class="str">' '</span><span class="pun">)]</span><span class="pln"><br>&nbsp; inputs </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">keras</span><span class="pun">.</span><span class="pln">preprocessing</span><span class="pun">.</span><span class="pln">sequence</span><span class="pun">.</span><span class="pln">pad_sequences</span><span class="pun">([</span><span class="pln">inputs</span><span class="pun">],</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; maxlen</span><span class="pun">=</span><span class="pln">max_length_input</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; padding</span><span class="pun">=</span><span class="str">'post'</span><span class="pun">)</span><span class="pln"><br>&nbsp; inputs </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">convert_to_tensor</span><span class="pun">(</span><span class="pln">inputs</span><span class="pun">)</span><span class="pln"><br>&nbsp; inference_batch_size </span><span class="pun">=</span><span class="pln"> inputs</span><span class="pun">.</span><span class="pln">shape</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"><br>&nbsp; result </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pln"><br><br>&nbsp; enc_start_state </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">tf</span><span class="pun">.</span><span class="pln">zeros</span><span class="pun">((</span><span class="pln">inference_batch_size</span><span class="pun">,</span><span class="pln"> units</span><span class="pun">)),</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">zeros</span><span class="pun">((</span><span class="pln">inference_batch_size</span><span class="pun">,</span><span class="pln">units</span><span class="pun">))]</span><span class="pln"><br>&nbsp; enc_out</span><span class="pun">,</span><span class="pln"> enc_h</span><span class="pun">,</span><span class="pln"> enc_c </span><span class="pun">=</span><span class="pln"> encoder</span><span class="pun">(</span><span class="pln">inputs</span><span class="pun">,</span><span class="pln"> enc_start_state</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; dec_h </span><span class="pun">=</span><span class="pln"> enc_h<br>&nbsp; dec_c </span><span class="pun">=</span><span class="pln"> enc_c<br><br>&nbsp; start_tokens </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">fill</span><span class="pun">([</span><span class="pln">inference_batch_size</span><span class="pun">],</span><span class="pln"> targ_lang</span><span class="pun">.</span><span class="pln">word_index</span><span class="pun">[</span><span class="str">'&lt;start&gt;'</span><span class="pun">])</span><span class="pln"><br>&nbsp; end_token </span><span class="pun">=</span><span class="pln"> targ_lang</span><span class="pun">.</span><span class="pln">word_index</span><span class="pun">[</span><span class="str">'&lt;end&gt;'</span><span class="pun">]</span><span class="pln"><br><br>&nbsp; greedy_sampler </span><span class="pun">=</span><span class="pln"> tfa</span><span class="pun">.</span><span class="pln">seq2seq</span><span class="pun">.</span><span class="typ">GreedyEmbeddingSampler</span><span class="pun">()</span><span class="pln"><br><br>&nbsp; </span><span class="com"># Instantiate BasicDecoder object</span><span class="pln"><br>&nbsp; decoder_instance </span><span class="pun">=</span><span class="pln"> tfa</span><span class="pun">.</span><span class="pln">seq2seq</span><span class="pun">.</span><span class="typ">BasicDecoder</span><span class="pun">(</span><span class="pln">cell</span><span class="pun">=</span><span class="pln">decoder</span><span class="pun">.</span><span class="pln">rnn_cell</span><span class="pun">,</span><span class="pln"> sampler</span><span class="pun">=</span><span class="pln">greedy_sampler</span><span class="pun">,</span><span class="pln"> output_layer</span><span class="pun">=</span><span class="pln">decoder</span><span class="pun">.</span><span class="pln">fc</span><span class="pun">)</span><span class="pln"><br>&nbsp; </span><span class="com"># Setup Memory in decoder stack</span><span class="pln"><br>&nbsp; decoder</span><span class="pun">.</span><span class="pln">attention_mechanism</span><span class="pun">.</span><span class="pln">setup_memory</span><span class="pun">(</span><span class="pln">enc_out</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; </span><span class="com"># set decoder_initial_state</span><span class="pln"><br>&nbsp; decoder_initial_state </span><span class="pun">=</span><span class="pln"> decoder</span><span class="pun">.</span><span class="pln">build_initial_state</span><span class="pun">(</span><span class="pln">inference_batch_size</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="pln">enc_h</span><span class="pun">,</span><span class="pln"> enc_c</span><span class="pun">],</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">float32</span><span class="pun">)</span><span class="pln"><br><br><br>&nbsp; </span><span class="com">### Since the BasicDecoder wraps around Decoder's rnn cell only, you have to ensure that the inputs to BasicDecoder </span><span class="pln"><br>&nbsp; </span><span class="com">### decoding step is output of embedding layer. tfa.seq2seq.GreedyEmbeddingSampler() takes care of this. </span><span class="pln"><br>&nbsp; </span><span class="com">### You only need to get the weights of embedding layer, which can be done by decoder.embedding.variables[0] and pass this callabble to BasicDecoder's call() function</span><span class="pln"><br><br>&nbsp; decoder_embedding_matrix </span><span class="pun">=</span><span class="pln"> decoder</span><span class="pun">.</span><span class="pln">embedding</span><span class="pun">.</span><span class="pln">variables</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"><br><br>&nbsp; outputs</span><span class="pun">,</span><span class="pln"> _</span><span class="pun">,</span><span class="pln"> _ </span><span class="pun">=</span><span class="pln"> decoder_instance</span><span class="pun">(</span><span class="pln">decoder_embedding_matrix</span><span class="pun">,</span><span class="pln"> start_tokens </span><span class="pun">=</span><span class="pln"> start_tokens</span><span class="pun">,</span><span class="pln"> end_token</span><span class="pun">=</span><span class="pln"> end_token</span><span class="pun">,</span><span class="pln"> initial_state</span><span class="pun">=</span><span class="pln">decoder_initial_state</span><span class="pun">)</span><span class="pln"><br>&nbsp; </span><span class="kwd">return</span><span class="pln"> outputs</span><span class="pun">.</span><span class="pln">sample_id</span><span class="pun">.</span><span class="pln">numpy</span><span class="pun">()</span><span class="pln"><br><br></span><span class="kwd">def</span><span class="pln"> translate</span><span class="pun">(</span><span class="pln">sentence</span><span class="pun">):</span><span class="pln"><br>&nbsp; result </span><span class="pun">=</span><span class="pln"> evaluate_sentence</span><span class="pun">(</span><span class="pln">sentence</span><span class="pun">)</span><span class="pln"><br>&nbsp; </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">result</span><span class="pun">)</span><span class="pln"><br>&nbsp; result </span><span class="pun">=</span><span class="pln"> targ_lang</span><span class="pun">.</span><span class="pln">sequences_to_texts</span><span class="pun">(</span><span class="pln">result</span><span class="pun">)</span><span class="pln"><br>&nbsp; </span><span class="kwd">print</span><span class="pun">(</span><span class="str">'Input: %s'</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="pun">(</span><span class="pln">sentence</span><span class="pun">))</span><span class="pln"><br>&nbsp; </span><span class="kwd">print</span><span class="pun">(</span><span class="str">'Predicted translation: {}'</span><span class="pun">.</span><span class="pln">format</span><span class="pun">(</span><span class="pln">result</span><span class="pun">))</span><span class="pln"><br></span></code></pre></devsite-code>
<h2 id="restore_the_latest_checkpoint_and_test" data-text="Restore the latest checkpoint and test" role="presentation"><span class="devsite-heading" role="heading" aria-level="2">Restore the latest checkpoint and test</span><button type="button" class="devsite-heading-link button-flat material-icons" aria-label="Copy link to this section: Restore the latest checkpoint and test" data-title="Copy link to this section: Restore the latest checkpoint and test" data-id="restore_the_latest_checkpoint_and_test"></button></h2>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="com"># restoring the latest checkpoint in checkpoint_dir</span><span class="pln"><br>checkpoint</span><span class="pun">.</span><span class="pln">restore</span><span class="pun">(</span><span class="pln">tf</span><span class="pun">.</span><span class="pln">train</span><span class="pun">.</span><span class="pln">latest_checkpoint</span><span class="pun">(</span><span class="pln">checkpoint_dir</span><span class="pun">))</span><span class="pln"><br></span></code></pre></devsite-code>
<devsite-code no-copy="" data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button></div><pre class="tfo-notebook-code-cell-output" translate="no" dir="ltr" is-upgraded="">&lt;tensorflow.python.training.tracking.util.CheckpointLoadStatus at 0x7f9499417390&gt;
</pre></devsite-code>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="pln">translate</span><span class="pun">(</span><span class="pln">u</span><span class="str">'hace mucho frio aqui.'</span><span class="pun">)</span><span class="pln"><br></span></code></pre></devsite-code>
<devsite-code no-copy="" data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button></div><pre class="tfo-notebook-code-cell-output" translate="no" dir="ltr" is-upgraded="">[[ 11  12  49 224  40   4   3]]
Input: hace mucho frio aqui.
Predicted translation: ['it s very pretty here . &lt;end&gt;']
</pre></devsite-code>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="pln">translate</span><span class="pun">(</span><span class="pln">u</span><span class="str">'esta es mi vida.'</span><span class="pun">)</span><span class="pln"><br></span></code></pre></devsite-code>
<devsite-code no-copy="" data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button></div><pre class="tfo-notebook-code-cell-output" translate="no" dir="ltr" is-upgraded="">[[ 20   9  22 190   4   3]]
Input: esta es mi vida.
Predicted translation: ['this is my life . &lt;end&gt;']
</pre></devsite-code>
<devsite-code data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-copy" data-category="Site-Wide Custom Events" data-label="Click To Copy" track-type="exampleCode" track-name="clickToCopy" aria-label="Copy code sample" data-title="Copy code sample"></button></div><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="pln">translate</span><span class="pun">(</span><span class="pln">u</span><span class="str">'¿todavia estan en casa?'</span><span class="pun">)</span><span class="pln"><br></span></code></pre></devsite-code>
<devsite-code no-copy="" data-copy-event-label=""><div class="devsite-code-buttons-container" role="group" aria-label="Action buttons"><button type="button" class="gc-analytics-event material-icons devsite-icon-code-dark devsite-toggle-dark" data-category="Site-Wide Custom Events" data-label="Dark Code Toggle" track-type="exampleCode" track-name="darkCodeToggle" aria-label="Dark code theme" data-title="Dark code theme"></button><button type="button" class="gc-analytics-event material-icons devsite-icon-code-light devsite-toggle-light" data-category="Site-Wide Custom Events" data-label="Light Code Toggle" track-type="exampleCode" track-name="lightCodeToggle" aria-label="Light code theme" data-title="Light code theme"></button></div><pre class="tfo-notebook-code-cell-output" translate="no" dir="ltr" is-upgraded="">[[25  7 90  8  3]]
Input: ¿todavia estan en casa?
Predicted translation: ['are you home ? &lt;end&gt;']
</pre></devsite-code>
<devsite-code data-copy-event-label=""><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="com"># wrong translation</span><span class="pln"><br>translate</span><span class="pun">(</span><span class="pln">u</span><span class="str">'trata de averiguarlo.'</span><span class="pun">)</span><span class="pln"><br></span></code></pre></devsite-code>
<devsite-code no-copy="" data-copy-event-label=""><pre class="tfo-notebook-code-cell-output" translate="no" dir="ltr" is-upgraded="">[[126  16 892  11  75   4   3]]
Input: trata de averiguarlo.
Predicted translation: ['try to figure it out . &lt;end&gt;']
</pre></devsite-code>

<h2 id="use_tf-addons_beamsearchdecoder" data-text="Use tf-addons BeamSearchDecoder">Use tf-addons BeamSearchDecoder</h2>
<devsite-code data-copy-event-label=""><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">def</span><span class="pln"> beam_evaluate_sentence</span><span class="pun">(</span><span class="pln">sentence</span><span class="pun">,</span><span class="pln"> beam_width</span><span class="pun">=</span><span class="lit">3</span><span class="pun">):</span><span class="pln"><br>&nbsp; sentence </span><span class="pun">=</span><span class="pln"> dataset_creator</span><span class="pun">.</span><span class="pln">preprocess_sentence</span><span class="pun">(</span><span class="pln">sentence</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; inputs </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">inp_lang</span><span class="pun">.</span><span class="pln">word_index</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> sentence</span><span class="pun">.</span><span class="pln">split</span><span class="pun">(</span><span class="str">' '</span><span class="pun">)]</span><span class="pln"><br>&nbsp; inputs </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">keras</span><span class="pun">.</span><span class="pln">preprocessing</span><span class="pun">.</span><span class="pln">sequence</span><span class="pun">.</span><span class="pln">pad_sequences</span><span class="pun">([</span><span class="pln">inputs</span><span class="pun">],</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; maxlen</span><span class="pun">=</span><span class="pln">max_length_input</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; padding</span><span class="pun">=</span><span class="str">'post'</span><span class="pun">)</span><span class="pln"><br>&nbsp; inputs </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">convert_to_tensor</span><span class="pun">(</span><span class="pln">inputs</span><span class="pun">)</span><span class="pln"><br>&nbsp; inference_batch_size </span><span class="pun">=</span><span class="pln"> inputs</span><span class="pun">.</span><span class="pln">shape</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"><br>&nbsp; result </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pln"><br><br>&nbsp; enc_start_state </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">tf</span><span class="pun">.</span><span class="pln">zeros</span><span class="pun">((</span><span class="pln">inference_batch_size</span><span class="pun">,</span><span class="pln"> units</span><span class="pun">)),</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">zeros</span><span class="pun">((</span><span class="pln">inference_batch_size</span><span class="pun">,</span><span class="pln">units</span><span class="pun">))]</span><span class="pln"><br>&nbsp; enc_out</span><span class="pun">,</span><span class="pln"> enc_h</span><span class="pun">,</span><span class="pln"> enc_c </span><span class="pun">=</span><span class="pln"> encoder</span><span class="pun">(</span><span class="pln">inputs</span><span class="pun">,</span><span class="pln"> enc_start_state</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; dec_h </span><span class="pun">=</span><span class="pln"> enc_h<br>&nbsp; dec_c </span><span class="pun">=</span><span class="pln"> enc_c<br><br>&nbsp; start_tokens </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">fill</span><span class="pun">([</span><span class="pln">inference_batch_size</span><span class="pun">],</span><span class="pln"> targ_lang</span><span class="pun">.</span><span class="pln">word_index</span><span class="pun">[</span><span class="str">'&lt;start&gt;'</span><span class="pun">])</span><span class="pln"><br>&nbsp; end_token </span><span class="pun">=</span><span class="pln"> targ_lang</span><span class="pun">.</span><span class="pln">word_index</span><span class="pun">[</span><span class="str">'&lt;end&gt;'</span><span class="pun">]</span><span class="pln"><br><br>&nbsp; </span><span class="com"># From official documentation</span><span class="pln"><br>&nbsp; </span><span class="com"># NOTE If you are using the BeamSearchDecoder with a cell wrapped in AttentionWrapper, then you must ensure that:</span><span class="pln"><br>&nbsp; </span><span class="com"># The encoder output has been tiled to beam_width via tfa.seq2seq.tile_batch (NOT tf.tile).</span><span class="pln"><br>&nbsp; </span><span class="com"># The batch_size argument passed to the get_initial_state method of this wrapper is equal to true_batch_size * beam_width.</span><span class="pln"><br>&nbsp; </span><span class="com"># The initial state created with get_initial_state above contains a cell_state value containing properly tiled final state from the encoder.</span><span class="pln"><br><br>&nbsp; enc_out </span><span class="pun">=</span><span class="pln"> tfa</span><span class="pun">.</span><span class="pln">seq2seq</span><span class="pun">.</span><span class="pln">tile_batch</span><span class="pun">(</span><span class="pln">enc_out</span><span class="pun">,</span><span class="pln"> multiplier</span><span class="pun">=</span><span class="pln">beam_width</span><span class="pun">)</span><span class="pln"><br>&nbsp; decoder</span><span class="pun">.</span><span class="pln">attention_mechanism</span><span class="pun">.</span><span class="pln">setup_memory</span><span class="pun">(</span><span class="pln">enc_out</span><span class="pun">)</span><span class="pln"><br>&nbsp; </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"beam_with * [batch_size, max_length_input, rnn_units] : &nbsp;3 * [1, 16, 1024]] :"</span><span class="pun">,</span><span class="pln"> enc_out</span><span class="pun">.</span><span class="pln">shape</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; </span><span class="com"># set decoder_inital_state which is an AttentionWrapperState considering beam_width</span><span class="pln"><br>&nbsp; hidden_state </span><span class="pun">=</span><span class="pln"> tfa</span><span class="pun">.</span><span class="pln">seq2seq</span><span class="pun">.</span><span class="pln">tile_batch</span><span class="pun">([</span><span class="pln">enc_h</span><span class="pun">,</span><span class="pln"> enc_c</span><span class="pun">],</span><span class="pln"> multiplier</span><span class="pun">=</span><span class="pln">beam_width</span><span class="pun">)</span><span class="pln"><br>&nbsp; decoder_initial_state </span><span class="pun">=</span><span class="pln"> decoder</span><span class="pun">.</span><span class="pln">rnn_cell</span><span class="pun">.</span><span class="pln">get_initial_state</span><span class="pun">(</span><span class="pln">batch_size</span><span class="pun">=</span><span class="pln">beam_width</span><span class="pun">*</span><span class="pln">inference_batch_size</span><span class="pun">,</span><span class="pln"> dtype</span><span class="pun">=</span><span class="pln">tf</span><span class="pun">.</span><span class="pln">float32</span><span class="pun">)</span><span class="pln"><br>&nbsp; decoder_initial_state </span><span class="pun">=</span><span class="pln"> decoder_initial_state</span><span class="pun">.</span><span class="pln">clone</span><span class="pun">(</span><span class="pln">cell_state</span><span class="pun">=</span><span class="pln">hidden_state</span><span class="pun">)</span><span class="pln"><br><br>&nbsp; </span><span class="com"># Instantiate BeamSearchDecoder</span><span class="pln"><br>&nbsp; decoder_instance </span><span class="pun">=</span><span class="pln"> tfa</span><span class="pun">.</span><span class="pln">seq2seq</span><span class="pun">.</span><span class="typ">BeamSearchDecoder</span><span class="pun">(</span><span class="pln">decoder</span><span class="pun">.</span><span class="pln">rnn_cell</span><span class="pun">,</span><span class="pln">beam_width</span><span class="pun">=</span><span class="pln">beam_width</span><span class="pun">,</span><span class="pln"> output_layer</span><span class="pun">=</span><span class="pln">decoder</span><span class="pun">.</span><span class="pln">fc</span><span class="pun">)</span><span class="pln"><br>&nbsp; decoder_embedding_matrix </span><span class="pun">=</span><span class="pln"> decoder</span><span class="pun">.</span><span class="pln">embedding</span><span class="pun">.</span><span class="pln">variables</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"><br><br>&nbsp; </span><span class="com"># The BeamSearchDecoder object's call() function takes care of everything.</span><span class="pln"><br>&nbsp; outputs</span><span class="pun">,</span><span class="pln"> final_state</span><span class="pun">,</span><span class="pln"> sequence_lengths </span><span class="pun">=</span><span class="pln"> decoder_instance</span><span class="pun">(</span><span class="pln">decoder_embedding_matrix</span><span class="pun">,</span><span class="pln"> start_tokens</span><span class="pun">=</span><span class="pln">start_tokens</span><span class="pun">,</span><span class="pln"> end_token</span><span class="pun">=</span><span class="pln">end_token</span><span class="pun">,</span><span class="pln"> initial_state</span><span class="pun">=</span><span class="pln">decoder_initial_state</span><span class="pun">)</span><span class="pln"><br>&nbsp; </span><span class="com"># outputs is tfa.seq2seq.FinalBeamSearchDecoderOutput object. </span><span class="pln"><br>&nbsp; </span><span class="com"># The final beam predictions are stored in outputs.predicted_id</span><span class="pln"><br>&nbsp; </span><span class="com"># outputs.beam_search_decoder_output is a tfa.seq2seq.BeamSearchDecoderOutput object which keep tracks of beam_scores and parent_ids while performing a beam decoding step</span><span class="pln"><br>&nbsp; </span><span class="com"># final_state = tfa.seq2seq.BeamSearchDecoderState object.</span><span class="pln"><br>&nbsp; </span><span class="com"># Sequence Length = [inference_batch_size, beam_width] details the maximum length of the beams that are generated</span><span class="pln"><br><br><br>&nbsp; </span><span class="com"># outputs.predicted_id.shape = (inference_batch_size, time_step_outputs, beam_width)</span><span class="pln"><br>&nbsp; </span><span class="com"># outputs.beam_search_decoder_output.scores.shape = (inference_batch_size, time_step_outputs, beam_width)</span><span class="pln"><br>&nbsp; </span><span class="com"># Convert the shape of outputs and beam_scores to (inference_batch_size, beam_width, time_step_outputs)</span><span class="pln"><br>&nbsp; final_outputs </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">transpose</span><span class="pun">(</span><span class="pln">outputs</span><span class="pun">.</span><span class="pln">predicted_ids</span><span class="pun">,</span><span class="pln"> perm</span><span class="pun">=(</span><span class="lit">0</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">1</span><span class="pun">))</span><span class="pln"><br>&nbsp; beam_scores </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">transpose</span><span class="pun">(</span><span class="pln">outputs</span><span class="pun">.</span><span class="pln">beam_search_decoder_output</span><span class="pun">.</span><span class="pln">scores</span><span class="pun">,</span><span class="pln"> perm</span><span class="pun">=(</span><span class="lit">0</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">1</span><span class="pun">))</span><span class="pln"><br><br>&nbsp; </span><span class="kwd">return</span><span class="pln"> final_outputs</span><span class="pun">.</span><span class="pln">numpy</span><span class="pun">(),</span><span class="pln"> beam_scores</span><span class="pun">.</span><span class="pln">numpy</span><span class="pun">()</span><span class="pln"><br></span></code></pre></devsite-code><devsite-code data-copy-event-label=""><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="kwd">def</span><span class="pln"> beam_translate</span><span class="pun">(</span><span class="pln">sentence</span><span class="pun">):</span><span class="pln"><br>&nbsp; result</span><span class="pun">,</span><span class="pln"> beam_scores </span><span class="pun">=</span><span class="pln"> beam_evaluate_sentence</span><span class="pun">(</span><span class="pln">sentence</span><span class="pun">)</span><span class="pln"><br>&nbsp; </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">result</span><span class="pun">.</span><span class="pln">shape</span><span class="pun">,</span><span class="pln"> beam_scores</span><span class="pun">.</span><span class="pln">shape</span><span class="pun">)</span><span class="pln"><br>&nbsp; </span><span class="kwd">for</span><span class="pln"> beam</span><span class="pun">,</span><span class="pln"> score </span><span class="kwd">in</span><span class="pln"> zip</span><span class="pun">(</span><span class="pln">result</span><span class="pun">,</span><span class="pln"> beam_scores</span><span class="pun">):</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">beam</span><span class="pun">.</span><span class="pln">shape</span><span class="pun">,</span><span class="pln"> score</span><span class="pun">.</span><span class="pln">shape</span><span class="pun">)</span><span class="pln"><br>&nbsp; &nbsp; output </span><span class="pun">=</span><span class="pln"> targ_lang</span><span class="pun">.</span><span class="pln">sequences_to_texts</span><span class="pun">(</span><span class="pln">beam</span><span class="pun">)</span><span class="pln"><br>&nbsp; &nbsp; output </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">a</span><span class="pun">[:</span><span class="pln">a</span><span class="pun">.</span><span class="pln">index</span><span class="pun">(</span><span class="str">'&lt;end&gt;'</span><span class="pun">)]</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> a </span><span class="kwd">in</span><span class="pln"> output</span><span class="pun">]</span><span class="pln"><br>&nbsp; &nbsp; beam_score </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">a</span><span class="pun">.</span><span class="pln">sum</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> a </span><span class="kwd">in</span><span class="pln"> score</span><span class="pun">]</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">print</span><span class="pun">(</span><span class="str">'Input: %s'</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="pun">(</span><span class="pln">sentence</span><span class="pun">))</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> range</span><span class="pun">(</span><span class="pln">len</span><span class="pun">(</span><span class="pln">output</span><span class="pun">)):</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="kwd">print</span><span class="pun">(</span><span class="str">'{} Predicted translation: {} &nbsp;{}'</span><span class="pun">.</span><span class="pln">format</span><span class="pun">(</span><span class="pln">i</span><span class="pun">+</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> output</span><span class="pun">[</span><span class="pln">i</span><span class="pun">],</span><span class="pln"> beam_score</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]))</span><span class="pln"><br></span></code></pre></devsite-code><devsite-code data-copy-event-label=""><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="pln">beam_translate</span><span class="pun">(</span><span class="pln">u</span><span class="str">'hace mucho frio aqui.'</span><span class="pun">)</span><span class="pln"><br></span></code></pre></devsite-code>
<devsite-code no-copy="" data-copy-event-label=""><pre class="tfo-notebook-code-cell-output" translate="no" dir="ltr" is-upgraded="">beam_with * [batch_size, max_length_input, rnn_units] :  3 * [1, 16, 1024]] : (3, 16, 1024)
(1, 3, 7) (1, 3, 7)
(3, 7) (3, 7)
Input: hace mucho frio aqui.
1 Predicted translation: it s very pretty here .   -4.117094039916992
2 Predicted translation: it s very cold here .   -14.85302734375
3 Predicted translation: it s very pretty news .   -25.59416389465332
</pre></devsite-code>
<devsite-code data-copy-event-label=""><pre class="" translate="no" dir="ltr" is-upgraded=""><code dir="ltr"><span class="pln">beam_translate</span><span class="pun">(</span><span class="pln">u</span><span class="str">'¿todavia estan en casa?'</span><span class="pun">)</span><span class="pln"><br></span></code></pre></devsite-code>
<devsite-code no-copy="" data-copy-event-label=""><pre class="tfo-notebook-code-cell-output" translate="no" dir="ltr" is-upgraded="">beam_with * [batch_size, max_length_input, rnn_units] :  3 * [1, 16, 1024]] : (3, 16, 1024)
(1, 3, 7) (1, 3, 7)
(3, 7) (3, 7)
Input: ¿todavia estan en casa?
1 Predicted translation: are you still home ?   -4.036754131317139
2 Predicted translation: are you still at home ?   -15.306867599487305
3 Predicted translation: are you still go home ?   -20.533388137817383
</pre></devsite-code>

    

    
  </div>

  

  
    
    
      
    <devsite-thumb-rating position="footer"><div class="devsite-thumb-rating" role="form" aria-labelledby="devsite-thumb-label-footer" tabindex="0"><div class="devsite-thumb-label" id="devsite-thumb-label-footer">Was this helpful?</div><div class="devsite-thumbs"><button class="devsite-thumb devsite-thumb-up" data-title="Helpful" aria-label="Helpful"><svg class="devsite-thumb-icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M21,7h-6.31l0.95-4.57l0.03-0.32c0-0.41-0.17-0.79-0.44-1.06L14.17,0c0,0-7.09,6.85-7.17,7H2v13h16 c0.83,0,1.54-0.5,1.84-1.22l3.02-7.05C22.95,11.5,23,11.26,23,11V9C23,7.9,22.1,7,21,7z M7,18H4V9h3V18z M21,11l-3,7H9V8l4.34-4.34 L12,9h9V11z"></path></svg></button><button class="devsite-thumb devsite-thumb-down" data-title="Not helpful" aria-label="Not helpful"><svg class="devsite-thumb-icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M3,17h6.31l-0.95,4.57l-0.03,0.32c0,0.41,0.17,0.79,0.44,1.06L9.83,24c0,0,7.09-6.85,7.17-7h5V4H6 C5.17,4,4.46,4.5,4.16,5.22l-3.02,7.05C1.05,12.5,1,12.74,1,13v2C1,16.1,1.9,17,3,17z M17,6h3v9h-3V6z M3,13l3-7h9v10l-4.34,4.34 L12,15H3V13z"></path></svg></button></div></div></devsite-thumb-rating>
  
       
    
    
  

  
  
</article>


<devsite-content-footer class="nocontent">
  <p>Except as otherwise noted, the content of this page is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 License</a>, and code samples are licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a>. For details, see the <a href="https://developers.google.com/site-policies">Google Developers Site Policies</a>. Java is a registered trademark of Oracle and/or its affiliates.</p>
  <p>Last updated 2021-11-19 UTC.</p>
</devsite-content-footer>


<devsite-notification>
</devsite-notification>


  
<div class="devsite-content-data">
  <template class="devsite-thumb-rating-down-categories">
  [{
      "type": "thumb-down",
      "id": "missingTheInformationINeed",
      "label":"Missing the information I need"
    },{
      "type": "thumb-down",
      "id": "tooComplicatedTooManySteps",
      "label":"Too complicated / too many steps"
    },{
      "type": "thumb-down",
      "id": "outOfDate",
      "label":"Out of date"
    },{
      "type": "thumb-down",
      "id": "samplesCodeIssue",
      "label":"Samples / code issue"
    },{
      "type": "thumb-down",
      "id": "otherDown",
      "label":"Other"
    }]
  </template>
  <template class="devsite-thumb-rating-up-categories">
  [{
      "type": "thumb-up",
      "id": "easyToUnderstand",
      "label":"Easy to understand"
    },{
      "type": "thumb-up",
      "id": "solvedMyProblem",
      "label":"Solved my problem"
    },{
      "type": "thumb-up",
      "id": "otherUp",
      "label":"Other"
    }]
  </template>
  
</div>
            
          </devsite-content>
        </main>
        <devsite-footer-promos class="devsite-footer">
          
            
          
        </devsite-footer-promos>
        <devsite-footer-linkboxes class="devsite-footer">
          
            
<nav class="devsite-footer-linkboxes nocontent" aria-label="Footer links">
  
  <ul class="devsite-footer-linkboxes-list">
    
    <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading no-link">Stay connected</h3>
      <ul class="devsite-footer-linkbox-list">
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="https://blog.tensorflow.org/" class="devsite-footer-linkbox-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
            
          
            Blog
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="https://discuss.tensorflow.org/" class="devsite-footer-linkbox-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
            
          
            Forum
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="https://github.com/tensorflow/" class="devsite-footer-linkbox-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Footer Link (index 3)">
            
          
            GitHub
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="https://twitter.com/tensorflow" class="devsite-footer-linkbox-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Footer Link (index 4)">
            
          
            Twitter
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="https://youtube.com/tensorflow" class="devsite-footer-linkbox-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Footer Link (index 5)">
            
              
              
            
          
            YouTube
          
          </a>
          
          
        </li>
        
      </ul>
    </li>
    
    <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading no-link">Support</h3>
      <ul class="devsite-footer-linkbox-list">
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="https://github.com/tensorflow/tensorflow/issues" class="devsite-footer-linkbox-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Footer Link (index 1)">
            
          
            Issue tracker
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="https://github.com/tensorflow/tensorflow/blob/master/RELEASE.md" class="devsite-footer-linkbox-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Footer Link (index 2)">
            
          
            Release notes
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="https://stackoverflow.com/questions/tagged/tensorflow" class="devsite-footer-linkbox-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Footer Link (index 3)">
            
          
            Stack Overflow
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="https://www.tensorflow.org/extras/tensorflow_brand_guidelines.pdf" class="devsite-footer-linkbox-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Footer Link (index 4)">
            
          
            Brand guidelines
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="https://www.tensorflow.org/about/bib" class="devsite-footer-linkbox-link gc-analytics-event" data-category="Site-Wide Custom Events" data-label="Footer Link (index 5)">
            
              
              
            
          
            Cite TensorFlow
          
          </a>
          
          
        </li>
        
      </ul>
    </li>
    
  </ul>
  
</nav>
          
        </devsite-footer-linkboxes>
        <devsite-footer-utility class="devsite-footer">
          
            

<div class="devsite-footer-utility nocontent">
  

  
  <nav class="devsite-footer-utility-links" aria-label="Utility links">
    
    <ul class="devsite-footer-utility-list">
      
      <li class="devsite-footer-utility-item
                 ">
        
        
        <a class="devsite-footer-utility-link gc-analytics-event" href="https://policies.google.com/terms" data-category="Site-Wide Custom Events" data-label="Footer Terms link">
          Terms
        </a>
        
      </li>
      
      <li class="devsite-footer-utility-item
                 ">
        
        
        <a class="devsite-footer-utility-link gc-analytics-event" href="https://policies.google.com/privacy" data-category="Site-Wide Custom Events" data-label="Footer Privacy link">
          Privacy
        </a>
        
      </li>
      
      <li class="devsite-footer-utility-item
                 devsite-footer-utility-button">
        
        <span class="devsite-footer-utility-description">Sign up for the TensorFlow newsletter</span>
        
        
        <a class="devsite-footer-utility-link gc-analytics-event" href="https://services.google.com/fb/forms/tensorflow/" data-category="Site-Wide Custom Events" data-label="Footer Subscribe link">
          Subscribe
        </a>
        
      </li>
      
    </ul>
    
    
<devsite-language-selector>
  <ul>
    
    
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=en" aria-current="true" lang="en">English</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=id" lang="id">Bahasa Indonesia</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=es_419" lang="es_419">Español – América Latina</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=fr" lang="fr">Français</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=it" lang="it">Italiano</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=pl" lang="pl">Polski</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=pt_br" lang="pt_br">Português – Brasil</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=vi" lang="vi">Tiếng Việt</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=tr" lang="tr">Türkçe</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=ru" lang="ru">Русский</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=he" lang="he">עברית</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=ar" lang="ar">العربيّة</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=fa" lang="fa">فارسی</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=hi" lang="hi">हिंदी</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=bn" lang="bn">বাংলা</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=th" lang="th">ภาษาไทย</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=zh_cn" lang="zh_cn">中文 – 简体</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=ja" lang="ja">日本語</a>
    </li>
    
    <li>
      <a href="https://www.tensorflow.org/addons/tutorials/networks_seq2seq_nmt?hl=ko" lang="ko">한국어</a>
    </li>
    
  </ul>
</devsite-language-selector>

  </nav>
</div>
          
        </devsite-footer-utility>
        <devsite-panel style="height: auto;"></devsite-panel>
      </section></section>
    <devsite-sitemask></devsite-sitemask>
    <devsite-snackbar type="cookie-notification" data-cookie-notice="0" style="bottom: 0px;">
</devsite-snackbar>
    <devsite-tooltip></devsite-tooltip>
    <devsite-heading-link></devsite-heading-link>
    <devsite-analytics analytics-iframe="">
      
        <script type="application/json" analytics="">[{"dimensions": {"dimension1": "Signed out", "dimension4": "TensorFlow Addons", "dimension6": "en", "dimension3": false, "dimension5": "en", "dimension12": false}, "gaid": "UA-69864048-1", "metrics": {"ratings_value": "metric1", "ratings_count": "metric2"}}]</script>
<script type="application/json" gtm="">{"parameters": {"freeTrialEligibleUser": "True", "internalUser": "False", "language": {"machineTranslated": "False", "requested": "en", "served": "en"}, "pageType": "article", "projectName": "TensorFlow Addons", "signedIn": "False", "tenant": "tensorflow", "recommendations": {"sourcePage": "", "sourceType": 0, "sourceRank": 0, "sourceIdenticalDescriptions": 0, "sourceTitleWords": 0, "sourceDescriptionWords": 0, "experiment": ""}}, "tags": ["GTM-MXSL34P"]}</script>
      
    <iframe src="TensorFlow%20Addons%20Networks%20Sequence-to-Sequence%20NMT%20with%20Attention%20Mechanism_files/analytics-iframe.htm"></iframe></devsite-analytics>
    
      <devsite-badger></devsite-badger>
    
    
    <script nonce="">
  
  (function(d,e,v,s,i,t,E){d['GoogleDevelopersObject']=i;
    t=e.createElement(v);t.async=1;t.src=s;E=e.getElementsByTagName(v)[0];
    E.parentNode.insertBefore(t,E);})(window, document, 'script',
    'https://www.gstatic.com/devrel-devsite/prod/v6cd15f45ec209c8961e07ea7e57ed9a0e9da4333bc915e67d1fcd2b2a9ec62d1/tensorflow/js/app_loader.js', '[15,"en",null,"/js/devsite_app_module.js","https://www.gstatic.com/devrel-devsite/prod/v6cd15f45ec209c8961e07ea7e57ed9a0e9da4333bc915e67d1fcd2b2a9ec62d1","https://www.gstatic.com/devrel-devsite/prod/v6cd15f45ec209c8961e07ea7e57ed9a0e9da4333bc915e67d1fcd2b2a9ec62d1/tensorflow","https://tensorflow-dot-devsite-v2-prod-3p.appspot.com",null,null,["/_pwa/tensorflow/manifest.json","https://www.gstatic.com/devrel-devsite/prod/v6cd15f45ec209c8961e07ea7e57ed9a0e9da4333bc915e67d1fcd2b2a9ec62d1/images/video-placeholder.svg","https://www.gstatic.com/devrel-devsite/prod/v6cd15f45ec209c8961e07ea7e57ed9a0e9da4333bc915e67d1fcd2b2a9ec62d1/tensorflow/images/favicon.png","https://www.gstatic.com/devrel-devsite/prod/v6cd15f45ec209c8961e07ea7e57ed9a0e9da4333bc915e67d1fcd2b2a9ec62d1/tensorflow/images/lockup.svg","https://fonts.googleapis.com/css?family=Google+Sans:400,500|Roboto:400,400italic,500,500italic,700,700italic|Roboto+Mono:400,500,700&display=swap"],1,null,[1,6,8,12,14,17,21,25,40,50,52,63,70,75,76,80,87,91,92,93,97,98,100,101,102,103,104,105,107,108,109,110,111,112,113,115,116,117,118,120,122,123,124,125,126,127,129,130,131,132,133,134,135,136,138,140,141,144,147,148,149,150,151,152,154,155,156,157,158,159,161,163,164,165,168,169,170,173,179,182,183,186,191,193],"AIzaSyCNm9YxQumEXwGJgTDjxoxXK6m1F-9720Q","AIzaSyCc76DZePGtoyUjqKrLdsMGk_ry7sljLbY","www.tensorflow.org","AIzaSyB9bqgQ2t11WJsOX8qNsCQ6U-w91mmqF-I","AIzaSyAdYnStPdzjcJJtQ0mvIaeaMKj7_t6J_Fg"]')
  
</script>
    <devsite-a11y-announce aria-live="assertive" aria-atomic="true"></devsite-a11y-announce>
  
</body></html>